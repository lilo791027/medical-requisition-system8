<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šå‰é†«ç™‚-è—¥å“é†«æè«‹è³¼ç³»çµ±</title>
    <meta name="description" content="ä¸Šå‰é†«ç™‚è—¥å“é†«æè«‹è³¼ç®¡ç†ç³»çµ±ï¼Œæä¾›å®Œæ•´çš„è«‹è³¼ã€æ¡è³¼ã€åº«å­˜ç®¡ç†åŠŸèƒ½">
    <meta name="keywords" content="é†«ç™‚,è—¥å“,é†«æ,è«‹è³¼,æ¡è³¼,åº«å­˜ç®¡ç†">
    
    <!-- å¼•å…¥SheetJSåº«ç”¨æ–¼Excelè§£æ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- å¼•å…¥Chart.jsç”¨æ–¼åœ–è¡¨å±•ç¤º -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ç™»å…¥é é¢ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 450px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .login-form h1 {
            color: #333;
            margin-bottom: 40px;
            font-size: 28px;
            font-weight: 700;
        }

        .demo-info {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .demo-info h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .demo-accounts {
            text-align: left;
            font-size: 14px;
            color: #555;
        }

        .demo-accounts div {
            margin: 8px 0;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 16px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.3);
        }

        .login-btn:active {
            transform: translateY(-1px);
        }

        /* ä¸»ç³»çµ±ä»‹é¢ */
        .main-system {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .header h1 {
            color: #333;
            font-size: 28px;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-welcome {
            color: #555;
            font-weight: 600;
        }

        .logout-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #ff4757, #ff3742);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 71, 87, 0.3);
        }

        .nav-menu {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .nav-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            justify-items: center;
        }

        .nav-btn {
            width: 100%;
            max-width: 250px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #2f3542, #40407a);
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .content-area {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            min-height: 700px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .page {
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .page.active {
            display: block;
        }

        .page h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 26px;
            font-weight: 700;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        /* è¡¨å–®æ¨£å¼ */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .form-col label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 15px;
        }

        .form-col input,
        .form-col select,
        .form-col textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-col input:focus,
        .form-col select:focus,
        .form-col textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .form-col textarea {
            height: 100px;
            resize: vertical;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #2ed573, #1dd1a1);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #ff3742);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #57606f, #747d8c);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffa726, #ff9800);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        /* è¡¨æ ¼æ¨£å¼ */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .table th,
        .table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            font-size: 14px;
            text-align: center;
        }

        .table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .table tr:hover {
            background: #e3f2fd;
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        /* å“é …è¡¨æ ¼ */
        .items-table {
            margin-top: 25px;
            border: 2px solid #667eea;
            border-radius: 12px;
            overflow: hidden;
        }

        .items-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        /* ä¸‹æ‹‰é¸å–® */
        .dropdown {
            position: relative;
            display: inline-block;
            margin-bottom: 25px;
        }

        .dropdown-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .dropdown-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background: white;
            min-width: 200px;
            box-shadow: 0 12px 25px rgba(0,0,0,0.15);
            border-radius: 8px;
            z-index: 1000;
            border: 1px solid #e0e0e0;
        }

        .dropdown-content.show {
            display: block;
            animation: dropdownShow 0.3s ease-out;
        }

        @keyframes dropdownShow {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-content a {
            color: #333;
            padding: 15px 20px;
            text-decoration: none;
            display: block;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .dropdown-content a:hover {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            color: #667eea;
        }

        /* ç‹€æ…‹æ¨™ç±¤ */
        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: linear-gradient(135deg, #ffa726, #ff9800);
            color: white;
        }

        .status-approved {
            background: linear-gradient(135deg, #66bb6a, #4caf50);
            color: white;
        }

        .status-rejected {
            background: linear-gradient(135deg, #ef5350, #f44336);
            color: white;
        }

        /* æœå°‹æ¡† */
        .search-box {
            width: 100%;
            max-width: 400px;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            margin-bottom: 25px;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.2);
        }

        /* åº«å­˜ç®¡ç† */
        .inventory-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .stat-card h3 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 16px;
            font-weight: 500;
        }

        /* æª”æ¡ˆä¸Šå‚³ */
        .file-upload {
            border: 3px dashed #d0d0d0;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            transform: translateY(-2px);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload p {
            margin: 10px 0;
            font-weight: 600;
        }

        .file-upload p:first-child {
            font-size: 18px;
            color: #333;
        }

        /* å‹¾é¸æ¡†æ¨£å¼ */
        .approved-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            transform: scale(1.3);
            accent-color: #667eea;
        }

        /* é¸æ“‡æ“ä½œå€åŸŸ */
        .selection-controls {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 2px solid #e0e0e0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .selection-controls h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 18px;
            font-weight: 700;
        }

        .selection-info {
            margin-top: 15px;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            font-weight: 500;
        }

        /* æ¨¡æ…‹æ¡† */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 3% auto;
            padding: 35px;
            border-radius: 15px;
            width: 95%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalShow 0.3s ease-out;
        }

        @keyframes modalShow {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #333;
        }

        .section-divider {
            border-top: 2px solid #e0e0e0;
            margin: 35px 0;
            padding-top: 25px;
        }

        .alert {
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 10px;
            font-weight: 500;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* ä¸Šå‚³ç‹€æ…‹æ¨£å¼ */
        .upload-status {
            margin-bottom: 25px;
        }

        .status-info {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            color: #0c5460;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 8px;
        }

        .status-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 8px;
        }

        .status-error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 8px;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .nav-buttons {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .inventory-stats {
                grid-template-columns: 1fr;
            }

            .table {
                font-size: 12px;
            }

            .table th,
            .table td {
                padding: 10px 8px;
            }

            .selection-controls {
                text-align: center;
            }

            .selection-controls .btn {
                margin: 5px;
                width: 100%;
            }

            .modal-content {
                margin: 10% auto;
                padding: 20px;
                width: 95%;
            }

            .login-form {
                padding: 30px 20px;
            }
        }

        /* åŠ è¼‰å‹•ç•« */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1001;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* GitHubé¢¨æ ¼ç¾åŒ– */
        .github-corner {
            position: fixed;
            top: 0;
            right: 0;
            z-index: 1001;
        }

        .github-corner svg {
            fill: #667eea;
            color: #fff;
            width: 80px;
            height: 80px;
        }

        .github-corner:hover .octo-arm {
            animation: octocat-wave 560ms ease-in-out;
        }

        @keyframes octocat-wave {
            0%, 100% { transform: rotate(0); }
            20%, 60% { transform: rotate(-25deg); }
            40%, 80% { transform: rotate(10deg); }
        }

        /* æš—è‰²ä¸»é¡Œæ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            }
            
            .content-area, .nav-menu, .header {
                background: rgba(255, 255, 255, 0.1);
                color: #ecf0f1;
            }
            
            .table {
                background: rgba(255, 255, 255, 0.05);
                color: #ecf0f1;
            }
        }
    </style>
</head>
<body>
    <!-- GitHub Corner -->
    <a href="https://github.com/yourusername/medical-procurement-system" class="github-corner" aria-label="View source on GitHub" target="_blank">
        <svg viewBox="0 0 250 250" aria-hidden="true">
            <path d="m0,0 0,250 250,250 0,-250 -250,0 z" fill="#667eea"></path>
            <path d="m0,0 0,250 250,250 0,-250 -250,0 z" fill="#fff"></path>
            <path d="m127.5,110.5 c-16.3,0 -29.5,13.2 -29.5,29.5 0,16.3 13.2,29.5 29.5,29.5 16.3,0 29.5,-13.2 29.5,-29.5 0,-16.3 -13.2,-29.5 -29.5,-29.5 z m0,54 c-13.5,0 -24.5,-11 -24.5,-24.5 0,-13.5 11,-24.5 24.5,-24.5 13.5,0 24.5,11 24.5,24.5 0,13.5 -11,24.5 -24.5,24.5 z" fill="#667eea"></path>
        </svg>
    </a>

    <!-- ç™»å…¥é é¢ -->
    <div id="loginPage" class="login-container">
        <div class="login-form">
            <h1>ğŸ¥ ä¸Šå‰é†«ç™‚<br>è—¥å“é†«æè«‹è³¼ç³»çµ±</h1>
            
            <div class="demo-info">
                <h3>ğŸ”‘ æ¼”ç¤ºå¸³è™Ÿ</h3>
                <div class="demo-accounts">
                    <div><strong>ç®¡ç†å“¡ï¼š</strong> admin / admin123</div>
                    <div><strong>é†«å¸«ï¼š</strong> doctor01 / doctor123</div>
                    <div><strong>ä¸»ç®¡ï¼š</strong> manager01 / manager123</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="username">å¸³è™Ÿ</label>
                <input type="text" id="username" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ" autocomplete="username">
            </div>
            <div class="form-group">
                <label for="password">å¯†ç¢¼</label>
                <input type="password" id="password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" autocomplete="current-password">
            </div>
            <button class="login-btn" type="button" onclick="login()">
                <span id="loginBtnText">ç™»å…¥ç³»çµ±</span>
                <span id="loginLoader" class="loading" style="display: none;"></span>
            </button>
        </div>
    </div>

    <!-- ä¸»ç³»çµ± -->
    <div id="mainSystem" class="main-system">
        <div class="container">
            <!-- é ‚éƒ¨æ¨™é¡Œ -->
            <div class="header">
                <h1>ğŸ¥ ä¸Šå‰é†«ç™‚ - è—¥å“é†«æè«‹è³¼ç³»çµ±</h1>
                <div class="user-info">
                    <span class="user-welcome">æ­¡è¿ï¼Œ<span id="currentUser"></span></span>
                    <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
                </div>
            </div>

            <!-- å°èˆªé¸å–® -->
            <div class="nav-menu">
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="showPage('newProcurement')">ğŸ“ æ–°å¢è«‹è³¼</button>
                    <button class="nav-btn" onclick="showPage('approvalManagement')" id="approvalBtn">
                        âœ… ç°½æ ¸ç®¡ç†
                        <span class="notification-badge" id="pendingCount" style="display: none;">0</span>
                    </button>
                    <button class="nav-btn" onclick="showPage('approved')">âœ”ï¸ å·²æ ¸å‡†</button>
                    <button class="nav-btn" onclick="showPage('rejected')">ğŸš« å·²é§å›</button>
                    <button class="nav-btn" onclick="showPage('createPurchase')">ğŸ“ å»ºç«‹æ¡è³¼å–®</button>
                    <button class="nav-btn" onclick="showPage('inventory')">ğŸ“¦ åº«å­˜ç®¡ç†</button>
                    <button class="nav-btn" onclick="showPage('systemAdmin')">ğŸ› ï¸ ç³»çµ±ç®¡ç†</button>
                </div>
            </div>

            <!-- å…§å®¹å€åŸŸ -->
            <div class="content-area">
                <!-- æ–°å¢è«‹è³¼é é¢ -->
                <div id="newProcurement" class="page active">
                    <h2>ğŸ“ æ–°å¢è«‹è³¼å–®</h2>
                    <form id="procurementForm">
                        <div class="form-row">
                            <div class="form-col">
                                <label>è«‹è³¼å–®è™Ÿ</label>
                                <input type="text" id="procurementNo" readonly>
                            </div>
                            <div class="form-col">
                                <label>ç”³è«‹æ—¥æœŸ</label>
                                <input type="date" id="applyDate">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>ç”³è«‹éƒ¨é–€</label>
                                <select id="department">
                                    <option value="">è«‹é¸æ“‡éƒ¨é–€</option>
                                    <option value="ç¸½éƒ¨">ç¸½éƒ¨</option>
                                    <option value="ä¸Šå‰">ä¸Šå‰</option>
                                    <option value="ç«‹å‰">ç«‹å‰</option>
                                    <option value="ç«‹ä¸">ç«‹ä¸</option>
                                    <option value="ä¸Šæ‰¿">ä¸Šæ‰¿</option>
                                    <option value="ç«‹å…¨">ç«‹å…¨</option>
                                    <option value="ç«‹ç«¹">ç«‹ç«¹</option>
                                    <option value="ç«‹é †">ç«‹é †</option>
                                    <option value="ä¸Šäº¬">ä¸Šäº¬</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <label>ç”³è«‹äººå§“å</label>
                                <input type="text" id="applicantName">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>è«‹è³¼äº‹ç”±</label>
                                <textarea id="procurementReason" placeholder="è«‹è©³ç´°èªªæ˜è«‹è³¼äº‹ç”±..."></textarea>
                            </div>
                        </div>
                        
                        <h3>è«‹è³¼å“é …</h3>
                        <button type="button" class="btn btn-primary" onclick="addItem()">â• æ–°å¢å“é …</button>
                        
                        <table class="table items-table" id="itemsTable">
                            <thead>
                                <tr>
                                    <th>é¡åˆ¥</th>
                                    <th>åç¨±</th>
                                    <th>è¦æ ¼</th>
                                    <th>æ•¸é‡</th>
                                    <th>å–®ä½</th>
                                    <th>é ä¼°å–®åƒ¹</th>
                                    <th>å°è¨ˆ</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="itemsTableBody">
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; text-align: right;">
                            <strong style="font-size: 18px; color: #667eea;">ç¸½é‡‘é¡ï¼šNT$ <span id="totalAmount">0</span></strong>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button type="button" class="btn btn-success" onclick="submitProcurement()">ğŸ“¤ æäº¤è«‹è³¼å–®</button>
                            <button type="button" class="btn btn-secondary" onclick="resetForm()">ğŸ”„ é‡è¨­</button>
                        </div>
                    </form>
                </div>

                <!-- ç°½æ ¸ç®¡ç†é é¢ -->
                <div id="approvalManagement" class="page">
                    <h2>âœ… ç°½æ ¸ç®¡ç†</h2>
                    
                    <div class="dropdown">
                        <button class="dropdown-btn" onclick="toggleDropdown('approvalDropdown')">
                            é¸æ“‡å–®æ“šé¡å‹ â–¼
                        </button>
                        <div class="dropdown-content" id="approvalDropdown">
                            <a href="#" onclick="showApprovalType('procurement')">1. è«‹è³¼å–®</a>
                            <a href="#" onclick="showApprovalType('purchase')">2. æ¡è³¼å–®</a>
                        </div>
                    </div>

                    <div id="procurementApproval" class="section-divider">
                        <h3>å¾…å¯©æ ¸è«‹è³¼å–®</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>è«‹è³¼å–®è™Ÿ</th>
                                    <th>ç”³è«‹æ—¥æœŸ</th>
                                    <th>ç”³è«‹éƒ¨é–€</th>
                                    <th>ç”³è«‹äºº</th>
                                    <th>ç¸½é‡‘é¡</th>
                                    <th>ç‹€æ…‹</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="pendingProcurementTable">
                                <!-- å‹•æ…‹æ–°å¢çš„è«‹è³¼å–®æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                            </tbody>
                        </table>
                    </div>

                    <div id="purchaseApproval" class="section-divider" style="display: none;">
                        <h3>å¾…å¯©æ ¸æ¡è³¼å–®</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>æ¡è³¼å–®è™Ÿ</th>
                                    <th>æ¡è³¼æ—¥æœŸ</th>
                                    <th>ä¾›æ‡‰å•†</th>
                                    <th>ç¸½é‡‘é¡</th>
                                    <th>ç‹€æ…‹</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="pendingPurchaseTable">
                                <!-- å‹•æ…‹æ–°å¢çš„æ¡è³¼å–®æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- å·²æ ¸å‡†é é¢ -->
                <div id="approved" class="page">
                    <h2>âœ”ï¸ å·²æ ¸å‡†</h2>
                    
                    <div class="dropdown">
                        <button class="dropdown-btn" onclick="toggleDropdown('approvedDropdown')">
                            é¸æ“‡å–®æ“šé¡å‹ â–¼
                        </button>
                        <div class="dropdown-content" id="approvedDropdown">
                            <a href="#" onclick="showApprovedType('procurement')">1. è«‹è³¼å–®</a>
                            <a href="#" onclick="showApprovedType('purchase')">2. æ¡è³¼å–®</a>
                        </div>
                    </div>

                    <div style="margin: 20px 0;">
                        <button class="btn btn-primary" onclick="downloadAllApproved()">ğŸ’¾ å…¨éƒ¨ä¸‹è¼‰è«‹è³¼/æ¡è³¼å–®</button>
                    </div>

                    <div id="approvedProcurementSection">
                        <h3>å·²æ ¸å‡†è«‹è³¼å–®</h3>
                        
                        <div class="selection-controls">
                            <h4>ğŸ“ æ‰¹é‡å»ºç«‹æ¡è³¼å–®</h4>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                                <button class="btn btn-success" onclick="createPurchaseFromSelected()">
                                    ğŸ“ å»ºç«‹æ¡è³¼å–® (<span id="selectedCount">0</span> é …)
                                </button>
                                <button class="btn btn-secondary" onclick="selectAllApproved()">â˜‘ï¸ å…¨é¸</button>
                                <button class="btn btn-secondary" onclick="clearAllApproved()">â˜ æ¸…é™¤</button>
                                <button class="btn btn-primary" onclick="previewSelectedItems()">ğŸ‘ï¸ é è¦½é¸æ“‡</button>
                            </div>
                            <div class="selection-info" id="selectionInfo">
                                è«‹å‹¾é¸è¦å»ºç«‹æ¡è³¼å–®çš„è«‹è³¼é …ç›®ï¼Œå¯ä»¥å¤šé¸
                            </div>
                        </div>
                        
                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="width: 60px;">
                                        <input type="checkbox" id="selectAllCheckbox" onchange="toggleAllApproved()" class="approved-checkbox">
                                        <br><small>å…¨é¸</small>
                                    </th>
                                    <th>è«‹è³¼å–®è™Ÿ</th>
                                    <th>ç”³è«‹æ—¥æœŸ</th>
                                    <th>ç”³è«‹éƒ¨é–€</th>
                                    <th>ç”³è«‹äºº</th>
                                    <th>ç¸½é‡‘é¡</th>
                                    <th>æ ¸å‡†äºº</th>
                                    <th>æ ¸å‡†æ™‚é–“</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="approvedProcurementTable">
                                <!-- å·²æ ¸å‡†çš„è«‹è³¼å–®æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                            </tbody>
                        </table>
                    </div>

                    <div id="approvedPurchaseSection" style="display: none;">
                        <h3>å·²æ ¸å‡†æ¡è³¼å–®</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>æ¡è³¼å–®è™Ÿ</th>
                                    <th>æ¡è³¼æ—¥æœŸ</th>
                                    <th>ä¾›æ‡‰å•†</th>
                                    <th>ç¸½é‡‘é¡</th>
                                    <th>æ ¸å‡†äºº</th>
                                    <th>æ ¸å‡†æ™‚é–“</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="approvedPurchaseTable">
                                <!-- å·²æ ¸å‡†çš„æ¡è³¼å–®æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- å·²é§å›é é¢ -->
                <div id="rejected" class="page">
                    <h2>ğŸš« å·²é§å›</h2>
                    
                    <div class="dropdown">
                        <button class="dropdown-btn" onclick="toggleDropdown('rejectedDropdown')">
                            é¸æ“‡å–®æ“šé¡å‹ â–¼
                        </button>
                        <div class="dropdown-content" id="rejectedDropdown">
                            <a href="#" onclick="showRejectedType('procurement')">1. è«‹è³¼å–®</a>
                            <a href="#" onclick="showRejectedType('purchase')">2. æ¡è³¼å–®</a>
                        </div>
                    </div>

                    <div id="rejectedProcurementSection">
                        <h3>å·²é§å›è«‹è³¼å–®</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>è«‹è³¼å–®è™Ÿ</th>
                                    <th>ç”³è«‹æ—¥æœŸ</th>
                                    <th>ç”³è«‹éƒ¨é–€</th>
                                    <th>ç”³è«‹äºº</th>
                                    <th>ç¸½é‡‘é¡</th>
                                    <th>é§å›äºº</th>
                                    <th>é§å›æ™‚é–“</th>
                                    <th>é§å›åŸå› </th>
                                </tr>
                            </thead>
                            <tbody id="rejectedProcurementTable">
                                <!-- å·²é§å›çš„è«‹è³¼å–®æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                            </tbody>
                        </table>
                    </div>

                    <div id="rejectedPurchaseSection" style="display: none;">
                        <h3>å·²é§å›æ¡è³¼å–®</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>æ¡è³¼å–®è™Ÿ</th>
                                    <th>æ¡è³¼æ—¥æœŸ</th>
                                    <th>ä¾›æ‡‰å•†</th>
                                    <th>ç¸½é‡‘é¡</th>
                                    <th>é§å›äºº</th>
                                    <th>é§å›æ™‚é–“</th>
                                    <th>é§å›åŸå› </th>
                                </tr>
                            </thead>
                            <tbody id="rejectedPurchaseTable">
                                <!-- å·²é§å›çš„æ¡è³¼å–®æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- å»ºç«‹æ¡è³¼å–®é é¢ -->
                <div id="createPurchase" class="page">
                    <h2>ğŸ“ å»ºç«‹æ¡è³¼å–®</h2>
                    <form id="purchaseForm">
                        <div class="form-row">
                            <div class="form-col">
                                <label>æ¡è³¼å–®è™Ÿ</label>
                                <input type="text" id="purchaseNo" readonly>
                            </div>
                            <div class="form-col">
                                <label>æ¡è³¼æ—¥æœŸ</label>
                                <input type="date" id="purchaseDate">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>ä¾›æ‡‰å•†</label>
                                <select id="supplier">
                                    <option value="">è«‹é¸æ“‡ä¾›æ‡‰å•†</option>
                                    <option value="å°ç£é†«æå…¬å¸">å°ç£é†«æå…¬å¸</option>
                                    <option value="åº·å¥é†«ç™‚å™¨æ">åº·å¥é†«ç™‚å™¨æ</option>
                                    <option value="å„ªè³ªè—¥å“ä¾›æ‡‰å•†">å„ªè³ªè—¥å“ä¾›æ‡‰å•†</option>
                                    <option value="å°ˆæ¥­é†«æè¡Œ">å°ˆæ¥­é†«æè¡Œ</option>
                                    <option value="é†«ç™‚ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸">é†«ç™‚ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸</option>
                                    <option value="å¥åº·é†«ç™‚ç”¨å“">å¥åº·é†«ç™‚ç”¨å“</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <label>è¯çµ¡äºº</label>
                                <input type="text" id="contactPerson" placeholder="è«‹è¼¸å…¥è¯çµ¡äººå§“å">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <label>å‚™è¨»</label>
                                <textarea id="purchaseNote" placeholder="è«‹å¡«å¯«æ¡è³¼å‚™è¨»..."></textarea>
                            </div>
                        </div>
                        
                        <h3>æ¡è³¼å“é …</h3>
                        <button type="button" class="btn btn-primary" onclick="addPurchaseItem()">â• æ–°å¢å“é …</button>
                        
                        <table class="table items-table" id="purchaseItemsTable">
                            <thead>
                                <tr>
                                    <th>å“é …ç·¨è™Ÿ</th>
                                    <th>å“é …åç¨±</th>
                                    <th>è¦æ ¼</th>
                                    <th>æ•¸é‡</th>
                                    <th>å–®ä½</th>
                                    <th>å–®åƒ¹</th>
                                    <th>å°è¨ˆ</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="purchaseItemsTableBody">
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 20px; text-align: right;">
                            <strong style="font-size: 18px; color: #667eea;">ç¸½é‡‘é¡ï¼šNT$ <span id="purchaseTotalAmount">0</span></strong>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button type="button" class="btn btn-success" onclick="submitPurchase()">ğŸ“¤ æäº¤æ¡è³¼å–®</button>
                            <button type="button" class="btn btn-secondary" onclick="resetPurchaseForm()">ğŸ”„ é‡è¨­</button>
                        </div>
                    </form>
                </div>

                <!-- åº«å­˜ç®¡ç†é é¢ -->
                <div id="inventory" class="page">
                    <h2>ğŸ“¦ åº«å­˜ç®¡ç†</h2>
                    
                    <!-- åº«å­˜çµ±è¨ˆ -->
                    <div class="inventory-stats">
                        <div class="stat-card">
                            <h3 id="lowStockCount">0</h3>
                            <p>ä½åº«å­˜å“é …</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="outOfStockCount">0</h3>
                            <p>ç¼ºè²¨å“é …</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="totalItemsCount">0</h3>
                            <p>ç¸½å“é …æ•¸</p>
                        </div>
                    </div>

                    <!-- æ“ä½œæŒ‰éˆ•å€ -->
                    <div style="margin-bottom: 25px; display: grid; grid-template-columns: 1fr auto; gap: 20px; align-items: start;">
                        <!-- Excelä¸Šå‚³åŠŸèƒ½ -->
                        <div class="file-upload" onclick="document.getElementById('excelFile').click()">
                            <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(event)">
                            <p>ğŸ“ é»æ“Šä¸Šå‚³Excelåº«å­˜æª”æ¡ˆ</p>
                            <p style="font-size: 14px; color: #666;">æ”¯æ´ .xlsx, .xls, .csv æ ¼å¼</p>
                            <p style="font-size: 12px; color: #888;">é æœŸæ¬„ä½ï¼šå“é …ç·¨è™Ÿ,å“é …åç¨±,é¡åˆ¥,è¦æ ¼,ç¾æœ‰åº«å­˜,å®‰å…¨åº«å­˜,å–®ä½</p>
                        </div>
                        
                        <!-- æ“ä½œæŒ‰éˆ• -->
                        <div style="display: flex; flex-direction: column; gap: 10px; min-width: 200px;">
                            <button class="btn btn-success" onclick="addInventoryItem()">â• æ–°å¢åº«å­˜å“é …</button>
                            <button class="btn btn-primary" onclick="downloadInventoryList()">ğŸ’¾ ä¸‹è¼‰åº«å­˜æ¸…å–®</button>
                            <button class="btn btn-secondary" onclick="refreshInventoryStats()">ğŸ”„ æ›´æ–°çµ±è¨ˆ</button>
                        </div>
                    </div>

                    <!-- æœå°‹åŠŸèƒ½ -->
                    <input type="text" class="search-box" placeholder="ğŸ” æœå°‹å“é …åç¨±ã€ç·¨è™Ÿ..." onkeyup="searchInventory(this.value)">

                    <!-- ä¸Šå‚³ç‹€æ…‹é¡¯ç¤º -->
                    <div id="uploadStatus" class="upload-status"></div>

                    <!-- åº«å­˜åˆ—è¡¨ -->
                    <h3 style="color: #ff4757;">âš ï¸ åº«å­˜å“é …ç®¡ç†</h3>
                    <table class="table" id="inventoryTable">
                        <thead>
                            <tr>
                                <th>å“é …ç·¨è™Ÿ</th>
                                <th>å“é …åç¨±</th>
                                <th>é¡åˆ¥</th>
                                <th>è¦æ ¼</th>
                                <th>ç¾æœ‰åº«å­˜</th>
                                <th>å®‰å…¨åº«å­˜</th>
                                <th>å–®ä½</th>
                                <th>ç‹€æ…‹</th>
                                <th>æœ€å¾Œæ›´æ–°</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                            <!-- åº«å­˜è³‡æ–™æœƒå‹•æ…‹è¼‰å…¥ -->
                        </tbody>
                    </table>
                </div>

                <!-- ç³»çµ±ç®¡ç†é é¢ -->
                <div id="systemAdmin" class="page">
                    <h2>ğŸ› ï¸ ç³»çµ±ç®¡ç†</h2>
                    
                    <div class="section-divider">
                        <h3>ğŸ‘¤ å¸³å¯†è¨­å®š</h3>
                        <form id="accountForm">
                            <div class="form-row">
                                <div class="form-col">
                                    <label>ä½¿ç”¨è€…å¸³è™Ÿ</label>
                                    <input type="text" id="adminUsername" placeholder="è«‹è¼¸å…¥æ–°å¸³è™Ÿ">
                                </div>
                                <div class="form-col">
                                    <label>ä½¿ç”¨è€…å¯†ç¢¼</label>
                                    <input type="password" id="adminPassword" placeholder="è«‹è¼¸å…¥æ–°å¯†ç¢¼">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>ä½¿ç”¨è€…å§“å</label>
                                    <input type="text" id="adminName" placeholder="è«‹è¼¸å…¥ä½¿ç”¨è€…å§“å">
                                </div>
                                <div class="form-col">
                                    <label>éƒ¨é–€</label>
                                    <select id="adminDepartment">
                                        <option value="">è«‹é¸æ“‡éƒ¨é–€</option>
                                        <option value="ç¸½éƒ¨">ç¸½éƒ¨</option>
                                        <option value="ä¸Šå‰">ä¸Šå‰</option>
                                        <option value="ç«‹å‰">ç«‹å‰</option>
                                        <option value="ç«‹ä¸">ç«‹ä¸</option>
                                        <option value="ä¸Šæ‰¿">ä¸Šæ‰¿</option>
                                        <option value="ç«‹å…¨">ç«‹å…¨</option>
                                        <option value="ç«‹ç«¹">ç«‹ç«¹</option>
                                        <option value="ç«‹é †">ç«‹é †</option>
                                        <option value="ä¸Šäº¬">ä¸Šäº¬</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>æ¬Šé™ç­‰ç´š</label>
                                    <select id="adminRole">
                                        <option value="">è«‹é¸æ“‡æ¬Šé™</option>
                                        <option value="ç”³è«‹è€…">ç”³è«‹è€…</option>
                                        <option value="å¯©æ ¸è€…">å¯©æ ¸è€…</option>
                                        <option value="ç®¡ç†è€…">ç®¡ç†è€…</option>
                                    </select>
                                </div>
                            </div>
                            <button type="button" class="btn btn-success" onclick="addUser()">â• æ–°å¢ä½¿ç”¨è€…</button>
                        </form>

                        <h4 style="margin-top: 30px;">ç¾æœ‰ä½¿ç”¨è€…åˆ—è¡¨</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>å¸³è™Ÿ</th>
                                    <th>å§“å</th>
                                    <th>éƒ¨é–€</th>
                                    <th>æ¬Šé™ç­‰ç´š</th>
                                    <th>å»ºç«‹æ—¥æœŸ</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="userTable">
                                <tr>
                                    <td>admin</td>
                                    <td>ç³»çµ±ç®¡ç†å“¡</td>
                                    <td>è³‡è¨Šéƒ¨</td>
                                    <td><span class="status-badge status-approved">ç®¡ç†è€…</span></td>
                                    <td>2025-01-01</td>
                                    <td>
                                        <button class="btn btn-primary" onclick="editUser('admin')">âœï¸ ç·¨è¼¯</button>
                                        <button class="btn btn-danger" onclick="deleteUser('admin')">ğŸ—‘ï¸ åˆªé™¤</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>doctor01</td>
                                    <td>ç‹é†«å¸«</td>
                                    <td>å…§ç§‘</td>
                                    <td><span class="status-badge status-pending">ç”³è«‹è€…</span></td>
                                    <td>2025-07-01</td>
                                    <td>
                                        <button class="btn btn-primary" onclick="editUser('doctor01')">âœï¸ ç·¨è¼¯</button>
                                        <button class="btn btn-danger" onclick="deleteUser('doctor01')">ğŸ—‘ï¸ åˆªé™¤</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>manager01</td>
                                    <td>é™³ä¸»ç®¡</td>
                                    <td>æ¡è³¼éƒ¨</td>
                                    <td><span class="status-badge status-approved">å¯©æ ¸è€…</span></td>
                                    <td>2025-06-15</td>
                                    <td>
                                        <button class="btn btn-primary" onclick="editUser('manager01')">âœï¸ ç·¨è¼¯</button>
                                        <button class="btn btn-danger" onclick="deleteUser('manager01')">ğŸ—‘ï¸ åˆªé™¤</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-divider">
                        <h3>âœ… ç°½æ ¸äººå“¡è¨­å®š</h3>
                        <form id="approverForm">
                            <div class="form-row">
                                <div class="form-col">
                                    <label>ç°½æ ¸æµç¨‹</label>
                                    <select id="approvalProcess">
                                        <option value="">è«‹é¸æ“‡ç°½æ ¸æµç¨‹</option>
                                        <option value="è«‹è³¼å–®å¯©æ ¸">è«‹è³¼å–®å¯©æ ¸</option>
                                        <option value="æ¡è³¼å–®å¯©æ ¸">æ¡è³¼å–®å¯©æ ¸</option>
                                        <option value="ç·Šæ€¥è«‹è³¼å¯©æ ¸">ç·Šæ€¥è«‹è³¼å¯©æ ¸</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <label>ç°½æ ¸é †åº</label>
                                    <select id="approvalOrder">
                                        <option value="">è«‹é¸æ“‡é †åº</option>
                                        <option value="1">ç¬¬ä¸€éšç°½æ ¸</option>
                                        <option value="2">ç¬¬äºŒéšç°½æ ¸</option>
                                        <option value="3">ç¬¬ä¸‰éšç°½æ ¸</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <label>ç°½æ ¸äººå“¡</label>
                                    <select id="approverName">
                                        <option value="">è«‹é¸æ“‡ç°½æ ¸äººå“¡</option>
                                        <option value="é™³ä¸»ç®¡">é™³ä¸»ç®¡</option>
                                        <option value="æ—å‰¯é™¢é•·">æ—å‰¯é™¢é•·</option>
                                        <option value="å¼µé™¢é•·">å¼µé™¢é•·</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <label>é‡‘é¡é™åˆ¶</label>
                                    <input type="number" id="amountLimit" placeholder="è«‹è¼¸å…¥é‡‘é¡ä¸Šé™">
                                </div>
                            </div>
                            <button type="button" class="btn btn-success" onclick="addApprover()">â• æ–°å¢ç°½æ ¸è¨­å®š</button>
                        </form>

                        <h4 style="margin-top: 30px;">ç°½æ ¸æµç¨‹è¨­å®š</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ç°½æ ¸æµç¨‹</th>
                                    <th>ç°½æ ¸é †åº</th>
                                    <th>ç°½æ ¸äººå“¡</th>
                                    <th>é‡‘é¡é™åˆ¶</th>
                                    <th>ç‹€æ…‹</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="approverTable">
                                <tr>
                                    <td>è«‹è³¼å–®å¯©æ ¸</td>
                                    <td>ç¬¬ä¸€éšç°½æ ¸</td>
                                    <td>é™³ä¸»ç®¡</td>
                                    <td>NT$ 50,000</td>
                                    <td><span class="status-badge status-approved">å•Ÿç”¨</span></td>
                                    <td>
                                        <button class="btn btn-primary" onclick="editApprover(1)">âœï¸ ç·¨è¼¯</button>
                                        <button class="btn btn-danger" onclick="deleteApprover(1)">ğŸ—‘ï¸ åˆªé™¤</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>æ¡è³¼å–®å¯©æ ¸</td>
                                    <td>ç¬¬ä¸€éšç°½æ ¸</td>
                                    <td>æ—å‰¯é™¢é•·</td>
                                    <td>NT$ 100,000</td>
                                    <td><span class="status-badge status-approved">å•Ÿç”¨</span></td>
                                    <td>
                                        <button class="btn btn-primary" onclick="editApprover(2)">âœï¸ ç·¨è¼¯</button>
                                        <button class="btn btn-danger" onclick="deleteApprover(2)">ğŸ—‘ï¸ åˆªé™¤</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>ç·Šæ€¥è«‹è³¼å¯©æ ¸</td>
                                    <td>ç¬¬ä¸€éšç°½æ ¸</td>
                                    <td>å¼µé™¢é•·</td>
                                    <td>ç„¡é™åˆ¶</td>
                                    <td><span class="status-badge status-approved">å•Ÿç”¨</span></td>
                                    <td>
                                        <button class="btn btn-primary" onclick="editApprover(3)">âœï¸ ç·¨è¼¯</button>
                                        <button class="btn btn-danger" onclick="deleteApprover(3)">ğŸ—‘ï¸ åˆªé™¤</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ…‹æ¡† -->
    <!-- æŸ¥çœ‹å–®æ“šæ¨¡æ…‹æ¡† -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('viewModal')">&times;</span>
            <h2 id="modalTitle">å–®æ“šè©³æƒ…</h2>
            <div id="modalContent">
                <!-- å‹•æ…‹å…§å®¹å°‡åœ¨é€™è£¡é¡¯ç¤º -->
            </div>
        </div>
    </div>

    <!-- åº«å­˜ç·¨è¼¯æ¨¡æ…‹æ¡† -->
    <div id="inventoryEditModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('inventoryEditModal')">&times;</span>
            <h2 id="inventoryModalTitle">ç·¨è¼¯åº«å­˜å“é …</h2>
            <form id="inventoryEditForm">
                <div class="form-row">
                    <div class="form-col">
                        <label>å“é …ç·¨è™Ÿ</label>
                        <input type="text" id="editItemCode" readonly>
                    </div>
                    <div class="form-col">
                        <label>å“é …åç¨±</label>
                        <input type="text" id="editItemName" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label>é¡åˆ¥</label>
                        <select id="editCategory" required>
                            <option value="">è«‹é¸æ“‡</option>
                            <option value="è—¥å“">è—¥å“</option>
                            <option value="é†«æ">é†«æ</option>
                            <option value="è€—æ">è€—æ</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label>è¦æ ¼</label>
                        <input type="text" id="editSpecification">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label>ç¾æœ‰åº«å­˜</label>
                        <input type="number" id="editCurrentStock" min="0" required>
                    </div>
                    <div class="form-col">
                        <label>å®‰å…¨åº«å­˜</label>
                        <input type="number" id="editSafetyStock" min="0" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label>å–®ä½</label>
                        <select id="editUnit" required>
                            <option value="">è«‹é¸æ“‡</option>
                            <option value="ç›’">ç›’</option>
                            <option value="ç“¶">ç“¶</option>
                            <option value="æ”¯">æ”¯</option>
                            <option value="å€‹">å€‹</option>
                            <option value="åŒ…">åŒ…</option>
                            <option value="å°">å°</option>
                        </select>
                    </div>
                </div>
                <div style="margin-top: 20px; text-align: right;">
                    <button type="button" class="btn btn-success" onclick="saveInventoryItem()">ğŸ’¾ ä¿å­˜</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('inventoryEditModal')">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- é§å›åŸå› æ¨¡æ…‹æ¡† -->
    <div id="rejectModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('rejectModal')">&times;</span>
            <h2>é§å›åŸå› </h2>
            <form id="rejectForm">
                <div class="form-group">
                    <label>è«‹å¡«å¯«é§å›åŸå› ï¼š</label>
                    <textarea id="rejectReason" style="width: 100%; height: 120px; margin-top: 10px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px;" placeholder="è«‹è©³ç´°èªªæ˜é§å›åŸå› ..."></textarea>
                </div>
                <div style="margin-top: 20px; text-align: right;">
                    <button type="button" class="btn btn-danger" onclick="confirmReject()">ç¢ºèªé§å›</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('rejectModal')">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- é€šçŸ¥ç³»çµ± -->
    <div id="notificationContainer" style="position: fixed; top: 20px; right: 20px; z-index: 3000; max-width: 400px;"></div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let currentUser = '';
        let itemCounter = 0;
        let purchaseItemCounter = 0;
        let currentRejectDoc = null;
        let currentRejectType = null;
        let pendingProcurements = []; // å„²å­˜å¾…å¯©æ ¸è«‹è³¼å–®
        let pendingPurchases = []; // å„²å­˜å¾…å¯©æ ¸æ¡è³¼å–®
        let approvedProcurements = []; // å„²å­˜å·²æ ¸å‡†è«‹è³¼å–®
        let rejectedProcurements = []; // å„²å­˜å·²é§å›è«‹è³¼å–®
        let inventoryData = []; // å„²å­˜åº«å­˜è³‡æ–™
        let editingInventoryItem = null; // æ­£åœ¨ç·¨è¼¯çš„åº«å­˜é …ç›®

        // é è¨­å¸³å¯†ï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­æ‡‰è©²ä½¿ç”¨æ›´å®‰å…¨çš„é©—è­‰æ–¹å¼ï¼‰
        const users = {
            'admin': { password: 'admin123', name: 'ç³»çµ±ç®¡ç†å“¡', role: 'ç®¡ç†è€…' },
            'doctor01': { password: 'doctor123', name: 'ç‹é†«å¸«', role: 'ç”³è«‹è€…' },
            'manager01': { password: 'manager123', name: 'é™³ä¸»ç®¡', role: 'å¯©æ ¸è€…' }
        };

        // ç¢ºä¿DOMè¼‰å…¥å®Œæˆå¾Œå†åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMè¼‰å…¥å®Œæˆ - GitHub Pagesç‰ˆæœ¬');
            initializeApp();
        });

        // åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
        function initializeApp() {
            console.log('åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼...');
            
            // ç¢ºä¿ç™»å…¥é é¢é¡¯ç¤º
            const loginPage = document.getElementById('loginPage');
            const mainSystem = document.getElementById('mainSystem');
            
            if (loginPage) {
                loginPage.style.display = 'flex';
                console.log('ç™»å…¥é é¢å·²é¡¯ç¤º');
            }
            
            if (mainSystem) {
                mainSystem.style.display = 'none';
                console.log('ä¸»ç³»çµ±å·²éš±è—');
            }

            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            setupEventListeners();
            
            // æª¢æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ç™»å…¥ç‹€æ…‹
            checkSavedLogin();
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            // Enteréµç™»å…¥
            document.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    const loginPage = document.getElementById('loginPage');
                    if (loginPage && getComputedStyle(loginPage).display !== 'none') {
                        login();
                    }
                }
            });

            // é»æ“Šå…¶ä»–åœ°æ–¹æ™‚é—œé–‰ä¸‹æ‹‰é¸å–®
            document.addEventListener('click', function(event) {
                if (!event.target.matches('.dropdown-btn')) {
                    const dropdowns = document.querySelectorAll('.dropdown-content');
                    dropdowns.forEach(dropdown => {
                        dropdown.classList.remove('show');
                    });
                }
            });

            // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨æ™‚é—œé–‰
            window.onclick = function(event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            }
        }

        // æª¢æŸ¥ä¿å­˜çš„ç™»å…¥ç‹€æ…‹
        function checkSavedLogin() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser && users[savedUser]) {
                // è‡ªå‹•ç™»å…¥
                currentUser = savedUser;
                showMainSystem();
            }
        }

        // ç™»å…¥åŠŸèƒ½
        function login() {
            console.log('ç™»å…¥å‡½æ•¸è¢«å‘¼å«');
            
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginBtn = document.querySelector('.login-btn');
            const loginBtnText = document.getElementById('loginBtnText');
            const loginLoader = document.getElementById('loginLoader');
            
            if (!usernameInput || !passwordInput) {
                console.error('æ‰¾ä¸åˆ°è¼¸å…¥æ¬„ä½');
                showNotification('ç³»çµ±éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°è¼¸å…¥æ¬„ä½', 'error');
                return;
            }
            
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            if (!username || !password) {
                showNotification('è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼', 'error');
                return;
            }

            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            loginBtnText.style.display = 'none';
            loginLoader.style.display = 'inline-block';
            loginBtn.disabled = true;

            // æ¨¡æ“¬ç™»å…¥å»¶é²
            setTimeout(() => {
                if (users[username] && users[username].password === password) {
                    console.log('ç™»å…¥æˆåŠŸ');
                    currentUser = username;
                    
                    // ä¿å­˜ç™»å…¥ç‹€æ…‹
                    localStorage.setItem('currentUser', username);
                    
                    showMainSystem();
                    showNotification('ç™»å…¥æˆåŠŸï¼æ­¡è¿ä½¿ç”¨ä¸Šå‰é†«ç™‚è—¥å“é†«æè«‹è³¼ç³»çµ±', 'success');
                } else {
                    console.log('ç™»å…¥å¤±æ•—');
                    showNotification('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤', 'error');
                }
                
                // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                loginBtnText.style.display = 'inline';
                loginLoader.style.display = 'none';
                loginBtn.disabled = false;
            }, 1000);
        }

        // é¡¯ç¤ºä¸»ç³»çµ±
        function showMainSystem() {
            const currentUserSpan = document.getElementById('currentUser');
            if (currentUserSpan) {
                currentUserSpan.textContent = users[currentUser]?.name || currentUser;
            }
            
            const loginPage = document.getElementById('loginPage');
            const mainSystem = document.getElementById('mainSystem');
            
            if (loginPage) {
                loginPage.style.display = 'none';
            }
            
            if (mainSystem) {
                mainSystem.style.display = 'block';
            }
            
            // åˆå§‹åŒ–ç³»çµ±
            initializeSystem();
        }

        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
                currentUser = '';
                localStorage.removeItem('currentUser');
                
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainSystem').style.display = 'none';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                showNotification('å·²ç™»å‡ºç³»çµ±', 'success');
            }
        }

        // åˆå§‹åŒ–ç³»çµ±
        function initializeSystem() {
            console.log('åˆå§‹åŒ–ç³»çµ±åŠŸèƒ½...');
            
            // ç”Ÿæˆå–®è™Ÿ
            generateProcurementNo();
            generatePurchaseNo();
            
            // è¨­ç½®ç•¶å‰æ—¥æœŸ
            const today = new Date().toISOString().split('T')[0];
            const applyDateInput = document.getElementById('applyDate');
            const purchaseDateInput = document.getElementById('purchaseDate');
            
            if (applyDateInput) applyDateInput.value = today;
            if (purchaseDateInput) purchaseDateInput.value = today;
            
            // åˆå§‹åŒ–åº«å­˜è³‡æ–™
            initializeInventoryData();
            
            // åˆå§‹åŒ–å…¨åŸŸé™£åˆ—
            if (!window.approvedPurchases) {
                window.approvedPurchases = [];
            }
            if (!window.rejectedPurchases) {
                window.rejectedPurchases = [];
            }
            
            // è¼‰å…¥ç¤ºä¾‹è³‡æ–™
            loadSampleData();
            
            // æ›´æ–°çµ±è¨ˆ
            updatePendingCount();
        }

        // è¼‰å…¥ç¤ºä¾‹è³‡æ–™
        function loadSampleData() {
            // æ·»åŠ ç¤ºä¾‹å¾…å¯©æ ¸è«‹è³¼å–®
            if (pendingProcurements.length === 0) {
                pendingProcurements.push({
                    procurementNo: 'PR20250725001',
                    applyDate: '2025-07-25',
                    department: 'å…§ç§‘',
                    applicantName: 'å¼µé†«å¸«',
                    procurementReason: 'æ€¥éœ€è£œå……ç—…æˆ¿ç”¨å“',
                    items: [
                        {
                            category: 'é†«æ',
                            itemName: 'è¡€å£“è¨ˆ',
                            specification: 'é›»å­å¼',
                            quantity: 2,
                            unit: 'å°',
                            unitPrice: 1500,
                            subtotal: 3000
                        }
                    ],
                    totalAmount: 3000,
                    status: 'å¾…å¯©æ ¸',
                    submitTime: '2025-07-25 09:30:00'
                });
            }

            // æ·»åŠ ç¤ºä¾‹å·²æ ¸å‡†è«‹è³¼å–®
            if (approvedProcurements.length === 0) {
                approvedProcurements.push({
                    procurementNo: 'PR20250724001',
                    applyDate: '2025-07-24',
                    department: 'æ€¥è¨ºç§‘',
                    applicantName: 'æé†«å¸«',
                    procurementReason: 'ç·Šæ€¥é†«ç™‚ç”¨å“è£œå……',
                    items: [
                        {
                            category: 'è—¥å“',
                            itemName: 'é˜¿æ–¯åŒ¹éˆ',
                            specification: '100mg',
                            quantity: 10,
                            unit: 'ç›’',
                            unitPrice: 150,
                            subtotal: 1500
                        }
                    ],
                    totalAmount: 1500,
                    status: 'å·²æ ¸å‡†',
                    submitTime: '2025-07-24 14:20:00',
                    approver: 'é™³ä¸»ç®¡',
                    approveTime: '2025-07-24 16:45:00'
                });
            }

            // æ›´æ–°è¡¨æ ¼
            updatePendingProcurementTable();
            updateApprovedProcurementTable();
        }

        // åˆå§‹åŒ–åº«å­˜è³‡æ–™
        function initializeInventoryData() {
            if (inventoryData.length === 0) {
                inventoryData = [
                    {
                        itemCode: 'MED001',
                        itemName: 'é˜¿æ–¯åŒ¹éˆ',
                        category: 'è—¥å“',
                        specification: '100mg/éŒ ',
                        currentStock: 5,
                        safetyStock: 50,
                        unit: 'ç›’',
                        lastUpdate: '2025-07-25'
                    },
                    {
                        itemCode: 'MED002',
                        itemName: 'è¡€å£“è¨ˆ',
                        category: 'é†«æ',
                        specification: 'é›»å­å¼',
                        currentStock: 15,
                        safetyStock: 30,
                        unit: 'å°',
                        lastUpdate: '2025-07-25'
                    },
                    {
                        itemCode: 'CON001',
                        itemName: 'ä¸€æ¬¡æ€§æ‰‹å¥—',
                        category: 'è€—æ',
                        specification: 'Mè™Ÿ',
                        currentStock: 0,
                        safetyStock: 100,
                        unit: 'ç›’',
                        lastUpdate: '2025-07-24'
                    },
                    {
                        itemCode: 'MED003',
                        itemName: 'é«”æº«è¨ˆ',
                        category: 'é†«æ',
                        specification: 'ç´…å¤–ç·š',
                        currentStock: 8,
                        safetyStock: 20,
                        unit: 'æ”¯',
                        lastUpdate: '2025-07-25'
                    }
                ];
            }
            
            updateInventoryTable();
            refreshInventoryStats();
        }

        // é é¢åˆ‡æ›
        function showPage(pageId) {
            console.log('åˆ‡æ›åˆ°é é¢:', pageId);
            
            // éš±è—æ‰€æœ‰é é¢
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„activeé¡
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // é¡¯ç¤ºæŒ‡å®šé é¢
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // è¨­ç½®å°æ‡‰æŒ‰éˆ•ç‚ºactive
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }

        // ç”Ÿæˆè«‹è³¼å–®è™Ÿ
        function generateProcurementNo() {
            const today = new Date();
            const dateStr = today.getFullYear().toString() + 
                           (today.getMonth() + 1).toString().padStart(2, '0') + 
                           today.getDate().toString().padStart(2, '0');
            const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            const procurementNoInput = document.getElementById('procurementNo');
            if (procurementNoInput) {
                procurementNoInput.value = `PR${dateStr}${randomNum}`;
            }
        }

        // ç”Ÿæˆæ¡è³¼å–®è™Ÿ
        function generatePurchaseNo() {
            const today = new Date();
            const dateStr = today.getFullYear().toString() + 
                           (today.getMonth() + 1).toString().padStart(2, '0') + 
                           today.getDate().toString().padStart(2, '0');
            const randomNum = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            const purchaseNoInput = document.getElementById('purchaseNo');
            if (purchaseNoInput) {
                purchaseNoInput.value = `PO${dateStr}${randomNum}`;
            }
        }

        // æ–°å¢å“é …
        function addItem() {
            itemCounter++;
            const tableBody = document.getElementById('itemsTableBody');
            if (!tableBody) return;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <select name="category_${itemCounter}" onchange="updateTotal()" required>
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="è—¥å“">è—¥å“</option>
                        <option value="é†«æ">é†«æ</option>
                        <option value="è€—æ">è€—æ</option>
                    </select>
                </td>
                <td><input type="text" name="itemName_${itemCounter}" placeholder="å“é …åç¨±" required></td>
                <td><input type="text" name="specification_${itemCounter}" placeholder="è¦æ ¼"></td>
                <td><input type="number" name="quantity_${itemCounter}" placeholder="æ•¸é‡" min="1" onchange="updateTotal()" required></td>
                <td>
                    <select name="unit_${itemCounter}" required>
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="ç›’">ç›’</option>
                        <option value="ç“¶">ç“¶</option>
                        <option value="æ”¯">æ”¯</option>
                        <option value="å€‹">å€‹</option>
                        <option value="åŒ…">åŒ…</option>
                        <option value="å°">å°</option>
                    </select>
                </td>
                <td><input type="number" name="unitPrice_${itemCounter}" placeholder="å–®åƒ¹" min="0" step="0.01" onchange="updateTotal()"></td>
                <td class="subtotal">0</td>
                <td><button type="button" class="btn btn-danger" onclick="removeItem(this)">ğŸ—‘ï¸</button></td>
            `;
            tableBody.appendChild(row);
        }

        // ç§»é™¤å“é …
        function removeItem(button) {
            if (confirm('ç¢ºå®šè¦ç§»é™¤æ­¤å“é …å—ï¼Ÿ')) {
                button.closest('tr').remove();
                updateTotal();
            }
        }

        // æ›´æ–°ç¸½é‡‘é¡
        function updateTotal() {
            let total = 0;
            const tableBody = document.getElementById('itemsTableBody');
            if (!tableBody) return;
            
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const quantityInput = row.querySelector('input[name^="quantity"]');
                const unitPriceInput = row.querySelector('input[name^="unitPrice"]');
                const subtotalCell = row.querySelector('.subtotal');
                
                if (quantityInput && unitPriceInput && subtotalCell) {
                    const quantity = parseFloat(quantityInput.value) || 0;
                    const unitPrice = parseFloat(unitPriceInput.value) || 0;
                    const subtotal = quantity * unitPrice;
                    
                    subtotalCell.textContent = subtotal.toLocaleString();
                    total += subtotal;
                }
            });
            
            const totalAmountSpan = document.getElementById('totalAmount');
            if (totalAmountSpan) {
                totalAmountSpan.textContent = total.toLocaleString();
            }
        }

        // æäº¤è«‹è³¼å–®
        function submitProcurement() {
            console.log('æäº¤è«‹è³¼å–®...');
            
            // åŸºæœ¬è³‡æ–™é©—è­‰
            const procurementNo = document.getElementById('procurementNo')?.value;
            const applyDate = document.getElementById('applyDate')?.value;
            const department = document.getElementById('department')?.value;
            const applicantName = document.getElementById('applicantName')?.value;
            const procurementReason = document.getElementById('procurementReason')?.value;
            
            if (!department) {
                showNotification('è«‹é¸æ“‡ç”³è«‹éƒ¨é–€', 'error');
                return;
            }
            
            if (!applicantName) {
                showNotification('è«‹å¡«å¯«ç”³è«‹äººå§“å', 'error');
                return;
            }
            
            if (!procurementReason) {
                showNotification('è«‹å¡«å¯«è«‹è³¼äº‹ç”±', 'error');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦æœ‰å“é …
            const tableBody = document.getElementById('itemsTableBody');
            if (!tableBody || tableBody.children.length === 0) {
                showNotification('è«‹è‡³å°‘æ–°å¢ä¸€å€‹å“é …', 'error');
                return;
            }
            
            // é©—è­‰å“é …è³‡æ–™ä¸¦æ”¶é›†å“é …è³‡è¨Š
            let isValid = true;
            let items = [];
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach((row, index) => {
                const category = row.querySelector('select[name^="category"]')?.value;
                const itemName = row.querySelector('input[name^="itemName"]')?.value;
                const specification = row.querySelector('input[name^="specification"]')?.value;
                const quantity = row.querySelector('input[name^="quantity"]')?.value;
                const unit = row.querySelector('select[name^="unit"]')?.value;
                const unitPrice = row.querySelector('input[name^="unitPrice"]')?.value;
                
                if (!category || !itemName || !quantity || !unit) {
                    showNotification(`ç¬¬ ${index + 1} å€‹å“é …è³‡æ–™ä¸å®Œæ•´`, 'error');
                    isValid = false;
                    return;
                }
                
                items.push({
                    category,
                    itemName,
                    specification: specification || '',
                    quantity: parseInt(quantity),
                    unit,
                    unitPrice: parseFloat(unitPrice) || 0,
                    subtotal: (parseInt(quantity) * (parseFloat(unitPrice) || 0))
                });
            });
            
            if (!isValid) return;
            
            // è¨ˆç®—ç¸½é‡‘é¡
            const totalAmount = items.reduce((sum, item) => sum + item.subtotal, 0);
            
            // å‰µå»ºæ–°çš„è«‹è³¼å–®ç‰©ä»¶
            const newProcurement = {
                procurementNo,
                applyDate,
                department,
                applicantName,
                procurementReason,
                items,
                totalAmount,
                status: 'å¾…å¯©æ ¸',
                submitTime: new Date().toLocaleString('zh-TW')
            };
            
            // åŠ å…¥åˆ°å¾…å¯©æ ¸åˆ—è¡¨
            pendingProcurements.push(newProcurement);
            
            // æ›´æ–°ç°½æ ¸ç®¡ç†é é¢çš„è¡¨æ ¼
            updatePendingProcurementTable();
            
            // æäº¤æˆåŠŸ
            showNotification('è«‹è³¼å–®æäº¤æˆåŠŸï¼', 'success');
            resetForm();
            
            // æ›´æ–°å¾…å¯©æ ¸æ•¸é‡
            updatePendingCount();
            
            console.log('æ–°è«‹è³¼å–®å·²åŠ å…¥:', newProcurement);
        }

        // é‡è¨­è¡¨å–®
        function resetForm() {
            const form = document.getElementById('procurementForm');
            if (form) {
                form.reset();
            }
            
            const tableBody = document.getElementById('itemsTableBody');
            if (tableBody) {
                tableBody.innerHTML = '';
            }
            
            const totalAmount = document.getElementById('totalAmount');
            if (totalAmount) {
                totalAmount.textContent = '0';
            }
            
            generateProcurementNo();
            const today = new Date().toISOString().split('T')[0];
            const applyDate = document.getElementById('applyDate');
            if (applyDate) {
                applyDate.value = today;
            }
            
            itemCounter = 0;
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info', duration = 4000) {
            const container = document.getElementById('notificationContainer');
            if (!container) return;
            
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'}`;
            notification.style.cssText = `
                margin-bottom: 10px;
                animation: slideInRight 0.3s ease-out;
                position: relative;
                cursor: pointer;
            `;
            
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸';
            notification.innerHTML = `
                <strong>${icon}</strong> ${message}
                <span style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;">&times;</span>
            `;
            
            // é»æ“Šé—œé–‰
            notification.onclick = () => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            };
            
            container.appendChild(notification);
            
            // è‡ªå‹•ç§»é™¤
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.animation = 'slideOutRight 0.3s ease-in';
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.parentNode.removeChild(notification);
                            }
                        }, 300);
                    }
                }, duration);
            }
        }

        // éŒ¯èª¤è™•ç†
        window.addEventListener('error', function(event) {
            console.error('å…¨åŸŸéŒ¯èª¤:', event.error);
            showNotification('ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡æ–°æ•´ç†é é¢æˆ–è¯ç¹«ç®¡ç†å“¡', 'error');
        });

        // æœªæ•ç²çš„PromiseéŒ¯èª¤
        window.addEventListener('unhandledrejection', function(event) {
            console.error('æœªè™•ç†çš„PromiseéŒ¯èª¤:', event.reason);
            showNotification('ç³»çµ±è™•ç†è«‹æ±‚æ™‚ç™¼ç”ŸéŒ¯èª¤', 'error');
        });

        // æ›´æ–°å¾…å¯©æ ¸è«‹è³¼å–®è¡¨æ ¼
        function updatePendingProcurementTable() {
            const tableBody = document.getElementById('pendingProcurementTable');
            if (!tableBody) return;
            
            // æ¸…ç©ºç¾æœ‰å…§å®¹
            tableBody.innerHTML = '';
            
            // é‡æ–°æ·»åŠ å¾…å¯©æ ¸çš„è«‹è³¼å–®
            pendingProcurements.forEach(procurement => {
                const row = document.createElement('tr');
                row.setAttribute('data-dynamic', 'true');
                row.innerHTML = `
                    <td>${procurement.procurementNo}</td>
                    <td>${procurement.applyDate}</td>
                    <td>${procurement.department}</td>
                    <td>${procurement.applicantName}</td>
                    <td style="text-align: right; font-weight: bold; color: #667eea;">NT$ ${procurement.totalAmount.toLocaleString()}</td>
                    <td><span class="status-badge status-pending">å¾…å¯©æ ¸</span></td>
                    <td>
                        <button class="btn btn-success" onclick="approveDocument('${procurement.procurementNo}', 'procurement')">âœ… æ ¸å‡†</button>
                        <button class="btn btn-danger" onclick="rejectDocument('${procurement.procurementNo}', 'procurement')">ğŸš« é§å›</button>
                        <button class="btn btn-primary" onclick="viewDocument('${procurement.procurementNo}')">ğŸ‘ï¸ æŸ¥çœ‹</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // æ›´æ–°å·²æ ¸å‡†è«‹è³¼å–®è¡¨æ ¼
        function updateApprovedProcurementTable() {
            const tableBody = document.getElementById('approvedProcurementTable');
            if (!tableBody) return;
            
            // æ¸…ç©ºç¾æœ‰å…§å®¹
            tableBody.innerHTML = '';
            
            // æ·»åŠ å·²æ ¸å‡†çš„è«‹è³¼å–®
            approvedProcurements.forEach(procurement => {
                const row = document.createElement('tr');
                row.setAttribute('data-dynamic', 'true');
                row.innerHTML = `
                    <td style="text-align: center;">
                        <input type="checkbox" 
                               class="approved-checkbox" 
                               data-procurement-id="${procurement.procurementNo}"
                               onchange="updateSelectedCount()">
                    </td>
                    <td>${procurement.procurementNo}</td>
                    <td>${procurement.applyDate}</td>
                    <td>${procurement.department}</td>
                    <td>${procurement.applicantName}</td>
                    <td style="text-align: right; font-weight: bold; color: #667eea;">NT$ ${procurement.totalAmount.toLocaleString()}</td>
                    <td>${procurement.approver}</td>
                    <td>${procurement.approveTime}</td>
                    <td>
                        <button class="btn btn-primary" onclick="downloadDocument('${procurement.procurementNo}')">ğŸ’¾ ä¸‹è¼‰</button>
                        <button class="btn btn-secondary" onclick="viewDocument('${procurement.procurementNo}')">ğŸ‘ï¸ æŸ¥çœ‹</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // æ›´æ–°é¸æ“‡è¨ˆæ•¸
            updateSelectedCount();
        }

        // æ›´æ–°å¾…å¯©æ ¸æ•¸é‡
        function updatePendingCount() {
            const totalPending = pendingProcurements.length + pendingPurchases.length;
            const badgeElement = document.getElementById('pendingCount');
            if (badgeElement) {
                badgeElement.textContent = totalPending;
                
                // å¦‚æœæ²’æœ‰å¾…å¯©æ ¸é …ç›®ï¼Œéš±è—å¾½ç« 
                if (totalPending === 0) {
                    badgeElement.style.display = 'none';
                } else {
                    badgeElement.style.display = 'flex';
                }
            }
        }

        // æ ¸å‡†æ–‡ä»¶
        function approveDocument(docId, type) {
            if (confirm(`ç¢ºå®šè¦æ ¸å‡† ${docId} å—ï¼Ÿ`)) {
                if (type === 'procurement') {
                    // å¾å¾…å¯©æ ¸ä¸­ç§»é™¤
                    const index = pendingProcurements.findIndex(proc => proc.procurementNo === docId);
                    if (index > -1) {
                        const approvedProc = pendingProcurements.splice(index, 1)[0];
                        approvedProc.status = 'å·²æ ¸å‡†';
                        approvedProc.approver = users[currentUser]?.name || currentUser;
                        approvedProc.approveTime = new Date().toLocaleString('zh-TW');
                        approvedProcurements.push(approvedProc);
                        
                        // æ›´æ–°è¡¨æ ¼
                        updatePendingProcurementTable();
                        updateApprovedProcurementTable();
                    }
                } else if (type === 'purchase') {
                    // å¾å¾…å¯©æ ¸æ¡è³¼å–®ä¸­ç§»é™¤
                    const index = pendingPurchases.findIndex(purch => purch.purchaseNo === docId);
                    if (index > -1) {
                        const approvedPurch = pendingPurchases.splice(index, 1)[0];
                        approvedPurch.status = 'å·²æ ¸å‡†';
                        approvedPurch.approver = users[currentUser]?.name || currentUser;
                        approvedPurch.approveTime = new Date().toLocaleString('zh-TW');
                        
                        // ç¢ºä¿å·²æ ¸å‡†æ¡è³¼å–®é™£åˆ—å­˜åœ¨
                        if (!window.approvedPurchases) {
                            window.approvedPurchases = [];
                        }
                        window.approvedPurchases.push(approvedPurch);
                        
                        // æ›´æ–°è¡¨æ ¼
                        updatePendingPurchaseTable();
                        updateApprovedPurchaseTable();
                    }
                }
                
                showNotification(`${docId} å·²æ ¸å‡†`, 'success');
                updatePendingCount();
            }
        }

        // é§å›æ–‡ä»¶
        function rejectDocument(docId, type) {
            currentRejectDoc = docId;
            currentRejectType = type;
            document.getElementById('rejectModal').style.display = 'block';
        }

        // ç¢ºèªé§å›
        function confirmReject() {
            const reason = document.getElementById('rejectReason')?.value;
            if (!reason || !reason.trim()) {
                showNotification('è«‹å¡«å¯«é§å›åŸå› ', 'error');
                return;
            }
            
            if (currentRejectType === 'procurement') {
                // å¾å¾…å¯©æ ¸ä¸­ç§»é™¤
                const index = pendingProcurements.findIndex(proc => proc.procurementNo === currentRejectDoc);
                if (index > -1) {
                    const rejectedProc = pendingProcurements.splice(index, 1)[0];
                    rejectedProc.status = 'å·²é§å›';
                    rejectedProc.rejecter = users[currentUser]?.name || currentUser;
                    rejectedProc.rejectTime = new Date().toLocaleString('zh-TW');
                    rejectedProc.rejectReason = reason;
                    rejectedProcurements.push(rejectedProc);
                    
                    // æ›´æ–°è¡¨æ ¼
                    updatePendingProcurementTable();
                    updateRejectedProcurementTable();
                }
            } else if (currentRejectType === 'purchase') {
                // å¾å¾…å¯©æ ¸æ¡è³¼å–®ä¸­ç§»é™¤
                const index = pendingPurchases.findIndex(purch => purch.purchaseNo === currentRejectDoc);
                if (index > -1) {
                    const rejectedPurch = pendingPurchases.splice(index, 1)[0];
                    rejectedPurch.status = 'å·²é§å›';
                    rejectedPurch.rejecter = users[currentUser]?.name || currentUser;
                    rejectedPurch.rejectTime = new Date().toLocaleString('zh-TW');
                    rejectedPurch.rejectReason = reason;
                    
                    // ç¢ºä¿å·²é§å›æ¡è³¼å–®é™£åˆ—å­˜åœ¨
                    if (!window.rejectedPurchases) {
                        window.rejectedPurchases = [];
                    }
                    window.rejectedPurchases.push(rejectedPurch);
                    
                    // æ›´æ–°è¡¨æ ¼
                    updatePendingPurchaseTable();
                    updateRejectedPurchaseTable();
                }
            }
            
            showNotification(`${currentRejectDoc} å·²é§å›`, 'success');
            closeModal('rejectModal');
            document.getElementById('rejectReason').value = '';
            updatePendingCount();
        }

        // æ›´æ–°å·²æ ¸å‡†æ¡è³¼å–®è¡¨æ ¼
        function updateApprovedPurchaseTable() {
            const tableBody = document.getElementById('approvedPurchaseTable');
            if (!tableBody) return;
            
            // æ¸…ç©ºç¾æœ‰çš„å‹•æ…‹è³‡æ–™
            const dynamicRows = tableBody.querySelectorAll('tr[data-dynamic="true"]');
            dynamicRows.forEach(row => row.remove());
            
            // ç¢ºä¿å·²æ ¸å‡†æ¡è³¼å–®é™£åˆ—å­˜åœ¨
            if (!window.approvedPurchases) {
                window.approvedPurchases = [];
            }
            
            // æ·»åŠ å·²æ ¸å‡†çš„æ¡è³¼å–®
            window.approvedPurchases.forEach(purchase => {
                const row = document.createElement('tr');
                row.setAttribute('data-dynamic', 'true');
                row.innerHTML = `
                    <td>${purchase.purchaseNo}</td>
                    <td>${purchase.purchaseDate}</td>
                    <td>${purchase.supplier}</td>
                    <td style="text-align: right; font-weight: bold; color: #667eea;">NT$ ${purchase.totalAmount.toLocaleString()}</td>
                    <td>${purchase.approver}</td>
                    <td>${purchase.approveTime}</td>
                    <td>
                        <button class="btn btn-primary" onclick="downloadPurchaseDocument('${purchase.purchaseNo}')">ğŸ’¾ ä¸‹è¼‰</button>
                        <button class="btn btn-secondary" onclick="viewPurchaseDocument('${purchase.purchaseNo}')">ğŸ‘ï¸ æŸ¥çœ‹</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // æ›´æ–°å·²é§å›æ¡è³¼å–®è¡¨æ ¼
        function updateRejectedPurchaseTable() {
            const tableBody = document.getElementById('rejectedPurchaseTable');
            if (!tableBody) return;
            
            // æ¸…ç©ºç¾æœ‰çš„å‹•æ…‹è³‡æ–™
            const dynamicRows = tableBody.querySelectorAll('tr[data-dynamic="true"]');
            dynamicRows.forEach(row => row.remove());
            
            // ç¢ºä¿å·²é§å›æ¡è³¼å–®é™£åˆ—å­˜åœ¨
            if (!window.rejectedPurchases) {
                window.rejectedPurchases = [];
            }
            
            // æ·»åŠ å·²é§å›çš„æ¡è³¼å–®
            window.rejectedPurchases.forEach(purchase => {
                const row = document.createElement('tr');
                row.setAttribute('data-dynamic', 'true');
                row.innerHTML = `
                    <td>${purchase.purchaseNo}</td>
                    <td>${purchase.purchaseDate}</td>
                    <td>${purchase.supplier}</td>
                    <td style="text-align: right; font-weight: bold; color: #ff4757;">NT$ ${purchase.totalAmount.toLocaleString()}</td>
                    <td>${purchase.rejecter}</td>
                    <td>${purchase.rejectTime}</td>
                    <td>${purchase.rejectReason}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // ä¸‹è¼‰æ¡è³¼æ–‡ä»¶
        function downloadPurchaseDocument(docId) {
            showNotification(`æ­£åœ¨ç”Ÿæˆ ${docId} æ–‡ä»¶...`, 'success');
            
            // å°‹æ‰¾æ¡è³¼å–®è³‡æ–™
            let documentData = null;
            
            if (window.approvedPurchases) {
                documentData = window.approvedPurchases.find(purch => purch.purchaseNo === docId);
            }
            
            if (!documentData && pendingPurchases) {
                documentData = pendingPurchases.find(purch => purch.purchaseNo === docId);
            }
            
            if (!documentData && window.rejectedPurchases) {
                documentData = window.rejectedPurchases.find(purch => purch.purchaseNo === docId);
            }
            
            if (documentData) {
                // ç”ŸæˆçœŸå¯¦çš„PDFå…§å®¹
                generatePDF(documentData, 'purchase');
            } else {
                // ç”Ÿæˆç¤ºä¾‹PDF
                generateSamplePurchasePDF(docId);
            }
        }

        // ç”Ÿæˆç¤ºä¾‹æ¡è³¼å–®PDF
        function generateSamplePurchasePDF(docId) {
            const sampleData = {
                purchaseNo: docId,
                purchaseDate: '2025-07-25',
                supplier: 'ç¤ºä¾‹ä¾›æ‡‰å•†',
                contactPerson: 'ç¤ºä¾‹è¯çµ¡äºº',
                purchaseNote: 'ç¤ºä¾‹æ¡è³¼å‚™è¨»',
                status: 'å·²æ ¸å‡†',
                submitTime: new Date().toLocaleString('zh-TW'),
                approver: 'ç¤ºä¾‹ä¸»ç®¡',
                approveTime: new Date().toLocaleString('zh-TW'),
                items: [
                    {
                        itemCode: 'PUR001',
                        itemName: 'è¡€å£“è¨ˆ',
                        specification: 'é›»å­å¼',
                        quantity: 2,
                        unit: 'å°',
                        unitPrice: 1500,
                        subtotal: 3000
                    },
                    {
                        itemCode: 'PUR002',
                        itemName: 'é«”æº«è¨ˆ',
                        specification: 'ç´…å¤–ç·š',
                        quantity: 5,
                        unit: 'æ”¯',
                        unitPrice: 200,
                        subtotal: 1000
                    }
                ],
                totalAmount: 4000
            };
            generatePDF(sampleData, 'purchase');
        }

        // æ›´æ–°å·²é§å›è«‹è³¼å–®è¡¨æ ¼
        function updateRejectedProcurementTable() {
            const tableBody = document.getElementById('rejectedProcurementTable');
            if (!tableBody) return;
            
            // æ¸…ç©ºç¾æœ‰å…§å®¹
            tableBody.innerHTML = '';
            
            // æ·»åŠ å·²é§å›çš„è«‹è³¼å–®
            rejectedProcurements.forEach(procurement => {
                const row = document.createElement('tr');
                row.setAttribute('data-dynamic', 'true');
                row.innerHTML = `
                    <td>${procurement.procurementNo}</td>
                    <td>${procurement.applyDate}</td>
                    <td>${procurement.department}</td>
                    <td>${procurement.applicantName}</td>
                    <td style="text-align: right; font-weight: bold; color: #ff4757;">NT$ ${procurement.totalAmount.toLocaleString()}</td>
                    <td>${procurement.rejecter}</td>
                    <td>${procurement.rejectTime}</td>
                    <td>${procurement.rejectReason}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // æŸ¥çœ‹æ–‡ä»¶
        function viewDocument(docId) {
            let documentData = null;
            
            // å¾å¾…å¯©æ ¸è«‹è³¼å–®ä¸­å°‹æ‰¾
            documentData = pendingProcurements.find(proc => proc.procurementNo === docId);
            
            // å¦‚æœåœ¨å¾…å¯©æ ¸ä¸­æ²’æ‰¾åˆ°ï¼Œå†å¾å·²æ ¸å‡†ä¸­å°‹æ‰¾
            if (!documentData) {
                documentData = approvedProcurements.find(proc => proc.procurementNo === docId);
            }
            
            // å¦‚æœé‚„æ˜¯æ²’æ‰¾åˆ°ï¼Œå¾å·²é§å›ä¸­å°‹æ‰¾
            if (!documentData) {
                documentData = rejectedProcurements.find(proc => proc.procurementNo === docId);
            }
            
            if (documentData) {
                // é¡¯ç¤ºçœŸå¯¦çš„è«‹è³¼å–®è³‡æ–™
                document.getElementById('modalTitle').textContent = `æŸ¥çœ‹ ${docId}`;
                
                let itemsTableHTML = '';
                documentData.items.forEach((item, index) => {
                    itemsTableHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${item.category}</td>
                            <td>${item.itemName}</td>
                            <td>${item.specification || '-'}</td>
                            <td>${item.quantity}</td>
                            <td>${item.unit}</td>
                            <td style="text-align: right;">NT$ ${item.unitPrice.toLocaleString()}</td>
                            <td style="text-align: right; font-weight: bold;">NT$ ${item.subtotal.toLocaleString()}</td>
                        </tr>
                    `;
                });
                
                document.getElementById('modalContent').innerHTML = `
                    <div class="form-row">
                        <div class="form-col">
                            <strong>è«‹è³¼å–®è™Ÿï¼š</strong>${documentData.procurementNo}
                        </div>
                        <div class="form-col">
                            <strong>ç”³è«‹æ—¥æœŸï¼š</strong>${documentData.applyDate}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <strong>ç”³è«‹éƒ¨é–€ï¼š</strong>${documentData.department}
                        </div>
                        <div class="form-col">
                            <strong>ç”³è«‹äººï¼š</strong>${documentData.applicantName}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <strong>è«‹è³¼äº‹ç”±ï¼š</strong>${documentData.procurementReason}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <strong>æäº¤æ™‚é–“ï¼š</strong>${documentData.submitTime}
                        </div>
                        <div class="form-col">
                            <strong>ç‹€æ…‹ï¼š</strong><span class="status-badge ${documentData.status === 'å·²æ ¸å‡†' ? 'status-approved' : documentData.status === 'å·²é§å›' ? 'status-rejected' : 'status-pending'}">${documentData.status}</span>
                        </div>
                    </div>
                    ${documentData.approver ? `
                    <div class="form-row">
                        <div class="form-col">
                            <strong>æ ¸å‡†äººï¼š</strong>${documentData.approver}
                        </div>
                        <div class="form-col">
                            <strong>æ ¸å‡†æ™‚é–“ï¼š</strong>${documentData.approveTime}
                        </div>
                    </div>` : ''}
                    ${documentData.rejecter ? `
                    <div class="form-row">
                        <div class="form-col">
                            <strong>é§å›äººï¼š</strong>${documentData.rejecter}
                        </div>
                        <div class="form-col">
                            <strong>é§å›æ™‚é–“ï¼š</strong>${documentData.rejectTime}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <strong>é§å›åŸå› ï¼š</strong>${documentData.rejectReason}
                        </div>
                    </div>` : ''}
                    <h4 style="margin-top: 25px; color: #333;">è«‹è³¼å“é …æ˜ç´°</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>é …æ¬¡</th>
                                <th>é¡åˆ¥</th>
                                <th>åç¨±</th>
                                <th>è¦æ ¼</th>
                                <th>æ•¸é‡</th>
                                <th>å–®ä½</th>
                                <th>é ä¼°å–®åƒ¹</th>
                                <th>å°è¨ˆ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsTableHTML}
                        </tbody>
                    </table>
                    <div style="text-align: right; margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong style="font-size: 18px; color: #667eea;">ç¸½é‡‘é¡ï¼šNT$ ${documentData.totalAmount.toLocaleString()}</strong>
                    </div>
                `;
            } else {
                // å¦‚æœæ‰¾ä¸åˆ°è³‡æ–™ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                document.getElementById('modalTitle').textContent = `æŸ¥çœ‹ ${docId}`;
                document.getElementById('modalContent').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>âŒ</strong> æ‰¾ä¸åˆ°æ­¤å–®æ“šçš„è©³ç´°è³‡æ–™
                    </div>
                `;
            }
            
            document.getElementById('viewModal').style.display = 'block';
        }

        // ä¸‹æ‹‰é¸å–®åŠŸèƒ½
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }

        // é¡¯ç¤ºç°½æ ¸é¡å‹
        function showApprovalType(type) {
            if (type === 'procurement') {
                document.getElementById('procurementApproval').style.display = 'block';
                document.getElementById('purchaseApproval').style.display = 'none';
            } else {
                document.getElementById('procurementApproval').style.display = 'none';
                document.getElementById('purchaseApproval').style.display = 'block';
            }
            toggleDropdown('approvalDropdown');
        }

        // é¡¯ç¤ºå·²æ ¸å‡†é¡å‹
        function showApprovedType(type) {
            if (type === 'procurement') {
                document.getElementById('approvedProcurementSection').style.display = 'block';
                document.getElementById('approvedPurchaseSection').style.display = 'none';
            } else {
                document.getElementById('approvedProcurementSection').style.display = 'none';
                document.getElementById('approvedPurchaseSection').style.display = 'block';
            }
            toggleDropdown('approvedDropdown');
        }

        // é¡¯ç¤ºå·²é§å›é¡å‹
        function showRejectedType(type) {
            if (type === 'procurement') {
                document.getElementById('rejectedProcurementSection').style.display = 'block';
                document.getElementById('rejectedPurchaseSection').style.display = 'none';
            } else {
                document.getElementById('rejectedProcurementSection').style.display = 'none';
                document.getElementById('rejectedPurchaseSection').style.display = 'block';
            }
            toggleDropdown('rejectedDropdown');
        }

        // æ›´æ–°é¸æ“‡è¨ˆæ•¸
        function updateSelectedCount() {
            const selectedCheckboxes = document.querySelectorAll('.approved-checkbox:checked');
            const count = selectedCheckboxes.length;
            const totalCheckboxes = document.querySelectorAll('.approved-checkbox');
            
            // æ›´æ–°è¨ˆæ•¸é¡¯ç¤º
            const countElement = document.getElementById('selectedCount');
            if (countElement) {
                countElement.textContent = count;
            }
            
            // æ›´æ–°é¸æ“‡è³‡è¨Š
            const infoElement = document.getElementById('selectionInfo');
            if (infoElement) {
                if (count === 0) {
                    infoElement.textContent = 'è«‹å‹¾é¸è¦å»ºç«‹æ¡è³¼å–®çš„è«‹è³¼é …ç›®ï¼Œå¯ä»¥å¤šé¸';
                    infoElement.style.color = '#666';
                } else {
                    const totalAmount = calculateSelectedTotal();
                    infoElement.innerHTML = `å·²é¸æ“‡ <strong>${count}</strong> å€‹è«‹è³¼å–®ï¼Œç¸½é‡‘é¡ï¼š<strong>NT$ ${totalAmount.toLocaleString()}</strong>`;
                    infoElement.style.color = '#28a745';
                }
            }
            
            // æ›´æ–°å…¨é¸æ¡†ç‹€æ…‹
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            if (selectAllCheckbox && totalCheckboxes.length > 0) {
                if (count === 0) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = false;
                } else if (count === totalCheckboxes.length) {
                    selectAllCheckbox.indeterminate = false;
                    selectAllCheckbox.checked = true;
                } else {
                    selectAllCheckbox.indeterminate = true;
                }
            }
        }

        // è¨ˆç®—é¸æ“‡é …ç›®çš„ç¸½é‡‘é¡
        function calculateSelectedTotal() {
            const selectedCheckboxes = document.querySelectorAll('.approved-checkbox:checked');
            let total = 0;
            
            selectedCheckboxes.forEach(checkbox => {
                const procurementId = checkbox.getAttribute('data-procurement-id');
                const procurement = approvedProcurements.find(p => p.procurementNo === procurementId);
                if (procurement) {
                    total += procurement.totalAmount;
                }
            });
            
            return total;
        }

        // åˆ‡æ›å…¨é¸ç‹€æ…‹
        function toggleAllApproved() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const checkboxes = document.querySelectorAll('.approved-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateSelectedCount();
        }

        // å…¨é¸å·²æ ¸å‡†é …ç›®
        function selectAllApproved() {
            const checkboxes = document.querySelectorAll('.approved-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            checkboxes.forEach(checkbox => checkbox.checked = true);
            if (selectAllCheckbox) selectAllCheckbox.checked = true;
            
            updateSelectedCount();
        }

        // æ¸…é™¤æ‰€æœ‰é¸æ“‡
        function clearAllApproved() {
            const checkboxes = document.querySelectorAll('.approved-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            checkboxes.forEach(checkbox => checkbox.checked = false);
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            }
            
            updateSelectedCount();
        }

        // é è¦½é¸æ“‡çš„é …ç›®
        function previewSelectedItems() {
            const selectedCheckboxes = document.querySelectorAll('.approved-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showNotification('è«‹å…ˆé¸æ“‡è¦é è¦½çš„è«‹è³¼å–®', 'error');
                return;
            }
            
            const selectedProcurements = [];
            selectedCheckboxes.forEach(checkbox => {
                const procurementId = checkbox.getAttribute('data-procurement-id');
                const procurement = approvedProcurements.find(p => p.procurementNo === procurementId);
                if (procurement) {
                    selectedProcurements.push(procurement);
                }
            });
            
            let previewContent = `
                <h3 style="color: #667eea;">ğŸ“‹ é è¦½é¸æ“‡çš„è«‹è³¼å–® (${selectedProcurements.length} ç­†)</h3>
                <div style="margin-bottom: 20px; padding: 15px; background: #e8f5e8; border-radius: 8px;">
                    <strong style="font-size: 18px; color: #2e7d32;">ğŸ’° ç¸½é‡‘é¡ï¼šNT$ ${calculateSelectedTotal().toLocaleString()}</strong>
                </div>
            `;
            
            selectedProcurements.forEach((procurement, index) => {
                previewContent += `
                    <div style="border: 2px solid #e0e0e0; padding: 20px; margin: 15px 0; border-radius: 10px; background: #f8f9fa;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">${index + 1}. ${procurement.procurementNo} - ${procurement.department}</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
                            <p><strong>ç”³è«‹äººï¼š</strong>${procurement.applicantName}</p>
                            <p><strong>ç”³è«‹æ—¥æœŸï¼š</strong>${procurement.applyDate}</p>
                            <p><strong>é‡‘é¡ï¼š</strong><span style="color: #667eea; font-weight: bold;">NT$ ${procurement.totalAmount.toLocaleString()}</span></p>
                            <p><strong>å“é …æ•¸é‡ï¼š</strong>${procurement.items.length} é …</p>
                        </div>
                        <details style="margin-top: 15px;">
                            <summary style="cursor: pointer; color: #667eea; font-weight: bold; padding: 5px 0;">ğŸ” æŸ¥çœ‹å“é …æ˜ç´°</summary>
                            <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px;">
                                ${procurement.items.map((item, itemIndex) => `
                                    <div style="padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between;">
                                        <span><strong>${itemIndex + 1}.</strong> ${item.itemName} (${item.specification || 'ç„¡è¦æ ¼'})</span>
                                        <span style="color: #667eea; font-weight: bold;">${item.quantity} ${item.unit} Ã— NT$ ${item.unitPrice.toLocaleString()} = NT$ ${item.subtotal.toLocaleString()}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </details>
                    </div>
                `;
            });
            
            document.getElementById('modalTitle').textContent = 'ğŸ‘ï¸ é è¦½é¸æ“‡é …ç›®';
            document.getElementById('modalContent').innerHTML = previewContent;
            document.getElementById('viewModal').style.display = 'block';
        }

        // é—œé–‰æ¨¡æ…‹æ¡†
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // åº«å­˜ç®¡ç†åŠŸèƒ½
        function updateInventoryTable() {
            const tableBody = document.getElementById('inventoryTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            inventoryData.forEach(item => {
                const row = document.createElement('tr');
                const status = getInventoryStatus(item);
                const statusClass = status === 'ç¼ºè²¨' ? 'status-rejected' : status === 'ä½åº«å­˜' ? 'status-pending' : 'status-approved';
                const stockColor = item.currentStock === 0 ? '#ff4757' : item.currentStock < item.safetyStock ? '#ffa726' : '#2ed573';
                
                row.innerHTML = `
                    <td style="font-weight: bold;">${item.itemCode}</td>
                    <td>${item.itemName}</td>
                    <td><span class="status-badge ${item.category === 'è—¥å“' ? 'status-approved' : item.category === 'é†«æ' ? 'status-pending' : 'status-rejected'}">${item.category}</span></td>
                    <td>${item.specification}</td>
                    <td style="color: ${stockColor}; font-weight: bold; font-size: 16px;">${item.currentStock}</td>
                    <td style="color: #666;">${item.safetyStock}</td>
                    <td>${item.unit}</td>
                    <td><span class="status-badge ${statusClass}">${status}</span></td>
                    <td>${item.lastUpdate}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editInventoryItem('${item.itemCode}')">âœï¸ ç·¨è¼¯</button>
                        <button class="btn btn-danger" onclick="deleteInventoryItem('${item.itemCode}')">ğŸ—‘ï¸ åˆªé™¤</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // ç²å–åº«å­˜ç‹€æ…‹
        function getInventoryStatus(item) {
            if (item.currentStock === 0) return 'ç¼ºè²¨';
            if (item.currentStock < item.safetyStock) return 'ä½åº«å­˜';
            return 'æ­£å¸¸';
        }

        // åˆ·æ–°åº«å­˜çµ±è¨ˆ
        function refreshInventoryStats() {
            const lowStockCount = inventoryData.filter(item => item.currentStock > 0 && item.currentStock < item.safetyStock).length;
            const outOfStockCount = inventoryData.filter(item => item.currentStock === 0).length;
            const totalCount = inventoryData.length;
            
            const lowStockElement = document.getElementById('lowStockCount');
            const outOfStockElement = document.getElementById('outOfStockCount');
            const totalItemsElement = document.getElementById('totalItemsCount');
            
            if (lowStockElement) lowStockElement.textContent = lowStockCount;
            if (outOfStockElement) outOfStockElement.textContent = outOfStockCount;
            if (totalItemsElement) totalItemsElement.textContent = totalCount;
        }

        // ä¸‹è¼‰æ–‡ä»¶
        function downloadDocument(docId) {
            showNotification(`æ­£åœ¨ç”Ÿæˆ ${docId} æ–‡ä»¶...`, 'success');
            
            // å°‹æ‰¾æ–‡ä»¶è³‡æ–™
            let documentData = null;
            documentData = pendingProcurements.find(proc => proc.procurementNo === docId) ||
                          approvedProcurements.find(proc => proc.procurementNo === docId) ||
                          rejectedProcurements.find(proc => proc.procurementNo === docId);
            
            if (documentData) {
                // ç”ŸæˆçœŸå¯¦çš„PDFå…§å®¹
                generatePDF(documentData, 'procurement');
            } else {
                // ç”Ÿæˆç¤ºä¾‹PDF
                generateSamplePDF(docId);
            }
        }

        // ç”ŸæˆPDFæ–‡ä»¶
        function generatePDF(data, type) {
            const pdfContent = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${type === 'procurement' ? 'è«‹è³¼å–®' : 'æ¡è³¼å–®'} - ${data.procurementNo || data.purchaseNo}</title>
    <style>
        body { 
            font-family: 'Microsoft JhengHei', Arial, sans-serif; 
            margin: 20px; 
            line-height: 1.6; 
            color: #333;
        }
        .header { 
            text-align: center; 
            border-bottom: 3px solid #667eea; 
            padding-bottom: 20px; 
            margin-bottom: 30px;
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
            padding: 30px;
            border-radius: 10px;
        }
        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .info-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 25px; 
            border: 2px solid #667eea;
            border-radius: 8px;
            overflow: hidden;
        }
        .info-table td { 
            padding: 12px 15px; 
            border: 1px solid #e0e0e0; 
        }
        .info-table td:first-child {
            background: #f8f9fa;
            font-weight: bold;
            color: #667eea;
            width: 20%;
        }
        .items-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 25px; 
            border: 2px solid #667eea;
            border-radius: 8px;
            overflow: hidden;
        }
        .items-table th, .items-table td { 
            padding: 12px; 
            border: 1px solid #e0e0e0; 
            text-align: center; 
        }
        .items-table th { 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            color: white; 
            font-weight: bold;
        }
        .items-table .text-left { text-align: left; }
        .items-table .text-right { text-align: right; }
        .subtotal-row { background: #f8f9fa; font-weight: bold; }
        .total-section { 
            margin-top: 30px; 
            border: 2px solid #667eea; 
            padding: 20px; 
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd); 
            border-radius: 10px;
        }
        .total-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid #ddd; 
        }
        .total-row.final { 
            border-bottom: 2px solid #667eea; 
            font-size: 20px; 
            font-weight: bold; 
            color: #667eea; 
            margin-top: 10px;
            padding-top: 15px;
        }
        .status { 
            font-weight: bold;
            padding: 5px 15px;
            border-radius: 15px;
            color: ${data.status === 'å·²æ ¸å‡†' ? '#28a745' : data.status === 'å·²é§å›' ? '#dc3545' : '#ffc107'}; 
            background: ${data.status === 'å·²æ ¸å‡†' ? '#d4edda' : data.status === 'å·²é§å›' ? '#f8d7da' : '#fff3cd'};
        }
        .signature-section { 
            margin-top: 40px; 
            display: flex; 
            justify-content: space-between; 
        }
        .signature-box { 
            width: 30%; 
            text-align: center; 
            border: 2px solid #667eea; 
            padding: 30px 10px; 
            border-radius: 10px;
            background: #f8f9fa;
        }
        .page-footer { 
            margin-top: 50px; 
            text-align: center; 
            color: #666; 
            font-size: 12px; 
            border-top: 2px solid #667eea; 
            padding-top: 20px; 
        }
        .approval-section {
            margin-top: 30px;
            padding: 20px;
            border: 2px solid #28a745;
            border-radius: 10px;
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
        }
        .reject-section {
            margin-top: 30px;
            padding: 20px;
            border: 2px solid #dc3545;
            border-radius: 10px;
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¥ ä¸Šå‰é†«ç™‚ - ${type === 'procurement' ? 'è«‹è³¼å–®' : 'æ¡è³¼å–®'}</h1>
        <h2 style="color: #333; margin-top: 10px;">${data.procurementNo || data.purchaseNo}</h2>
        <p style="margin: 10px 0; color: #666;">æ–‡ä»¶ç”Ÿæˆæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}</p>
    </div>
    
    <table class="info-table">
        <tr>
            <td><strong>${type === 'procurement' ? 'è«‹è³¼å–®è™Ÿ' : 'æ¡è³¼å–®è™Ÿ'}</strong></td>
            <td>${data.procurementNo || data.purchaseNo}</td>
            <td><strong>${type === 'procurement' ? 'ç”³è«‹æ—¥æœŸ' : 'æ¡è³¼æ—¥æœŸ'}</strong></td>
            <td>${data.applyDate || data.purchaseDate}</td>
        </tr>
        <tr>
            <td><strong>${type === 'procurement' ? 'ç”³è«‹éƒ¨é–€' : 'ä¾›æ‡‰å•†'}</strong></td>
            <td>${data.department || data.supplier}</td>
            <td><strong>${type === 'procurement' ? 'ç”³è«‹äºº' : 'è¯çµ¡äºº'}</strong></td>
            <td>${data.applicantName || data.contactPerson}</td>
        </tr>
        <tr>
            <td><strong>${type === 'procurement' ? 'è«‹è³¼äº‹ç”±' : 'å‚™è¨»'}</strong></td>
            <td colspan="3">${data.procurementReason || data.purchaseNote || 'ç„¡'}</td>
        </tr>
        <tr>
            <td><strong>ç‹€æ…‹</strong></td>
            <td><span class="status">${data.status}</span></td>
            <td><strong>æäº¤æ™‚é–“</strong></td>
            <td>${data.submitTime}</td>
        </tr>
    </table>
    
    <h3 style="margin-top: 30px; color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
        ${type === 'procurement' ? 'ğŸ“‹ è«‹è³¼å“é …æ˜ç´°' : 'ğŸ“‹ æ¡è³¼å“é …æ˜ç´°'}
    </h3>
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 8%;">é …æ¬¡</th>
                <th style="width: 15%;">${type === 'procurement' ? 'é¡åˆ¥' : 'å“é …ç·¨è™Ÿ'}</th>
                <th style="width: 25%;">å“é …åç¨±</th>
                <th style="width: 20%;">è¦æ ¼</th>
                <th style="width: 8%;">æ•¸é‡</th>
                <th style="width: 8%;">å–®ä½</th>
                <th style="width: 12%;">å–®åƒ¹</th>
                <th style="width: 12%;">å°è¨ˆ</th>
            </tr>
        </thead>
        <tbody>
            ${data.items.map((item, index) => `
                <tr>
                    <td><strong>${index + 1}</strong></td>
                    <td class="text-left">${item.category || item.itemCode || ''}</td>
                    <td class="text-left"><strong>${item.itemName}</strong></td>
                    <td class="text-left">${item.specification || '-'}</td>
                    <td><strong>${item.quantity}</strong></td>
                    <td>${item.unit}</td>
                    <td class="text-right">NT$ ${item.unitPrice.toLocaleString()}</td>
                    <td class="text-right"><strong>NT$ ${item.subtotal.toLocaleString()}</strong></td>
                </tr>
            `).join('')}
            <tr class="subtotal-row">
                <td colspan="6" style="text-align: right; padding: 15px;"><strong>å“é …å°è¨ˆï¼š</strong></td>
                <td style="text-align: right;"><strong>å…± ${data.items.length} é …</strong></td>
                <td style="text-align: right; color: #667eea;"><strong>NT$ ${data.items.reduce((sum, item) => sum + item.subtotal, 0).toLocaleString()}</strong></td>
            </tr>
        </tbody>
    </table>
    
    <div class="total-section">
        <h3 style="margin-top: 0; color: #667eea; text-align: center;">ğŸ’° é‡‘é¡ç¸½è¨ˆ</h3>
        <div class="total-row">
            <span>å“é …ç¸½è¨ˆï¼š</span>
            <span>NT$ ${data.items.reduce((sum, item) => sum + item.subtotal, 0).toLocaleString()}</span>
        </div>
        <div class="total-row">
            <span>ç¨…é¡ (5%)ï¼š</span>
            <span>NT$ ${Math.round(data.items.reduce((sum, item) => sum + item.subtotal, 0) * 0.05).toLocaleString()}</span>
        </div>
        <div class="total-row final">
            <span>ç¸½è¨ˆé‡‘é¡ï¼š</span>
            <span>NT$ ${Math.round(data.items.reduce((sum, item) => sum + item.subtotal, 0) * 1.05).toLocaleString()}</span>
        </div>
        <div style="margin-top: 15px; text-align: center; font-size: 14px; color: #666;">
            (å«ç¨…ç¸½é¡)
        </div>
    </div>
    
    ${data.approver ? `
    <div class="approval-section">
        <h4 style="color: #28a745; margin-top: 0;">âœ… æ ¸å‡†è³‡è¨Š</h4>
        <p><strong>æ ¸å‡†äººï¼š</strong>${data.approver}</p>
        <p><strong>æ ¸å‡†æ™‚é–“ï¼š</strong>${data.approveTime}</p>
        <p style="margin-bottom: 0;"><strong>å‚™è¨»ï¼š</strong>æ­¤${type === 'procurement' ? 'è«‹è³¼å–®' : 'æ¡è³¼å–®'}å·²é€šéå¯©æ ¸ï¼Œå¯é€²è¡Œå¾ŒçºŒæµç¨‹</p>
    </div>` : ''}
    
    ${data.rejecter ? `
    <div class="reject-section">
        <h4 style="color: #dc3545; margin-top: 0;">âŒ é§å›è³‡è¨Š</h4>
        <p><strong>é§å›äººï¼š</strong>${data.rejecter}</p>
        <p><strong>é§å›æ™‚é–“ï¼š</strong>${data.rejectTime}</p>
        <p style="margin-bottom: 0;"><strong>é§å›åŸå› ï¼š</strong>${data.rejectReason}</p>
    </div>` : ''}
    
    <div class="signature-section">
        <div class="signature-box">
            <div style="font-weight: bold; margin-bottom: 20px; color: #667eea;">${type === 'procurement' ? 'ç”³è«‹äººç°½å' : 'æ¡è³¼äººå“¡ç°½å'}</div>
            <div style="height: 50px; border-bottom: 1px solid #ccc; margin: 20px 0;"></div>
            <div style="color: #666;">æ—¥æœŸï¼š_____________</div>
        </div>
        <div class="signature-box">
            <div style="font-weight: bold; margin-bottom: 20px; color: #667eea;">éƒ¨é–€ä¸»ç®¡ç°½å</div>
            <div style="height: 50px; border-bottom: 1px solid #ccc; margin: 20px 0;"></div>
            <div style="color: #666;">æ—¥æœŸï¼š_____________</div>
        </div>
        <div class="signature-box">
            <div style="font-weight: bold; margin-bottom: 20px; color: #667eea;">æ¡è³¼ä¸»ç®¡ç°½å</div>
            <div style="height: 50px; border-bottom: 1px solid #ccc; margin: 20px 0;"></div>
            <div style="color: #666;">æ—¥æœŸï¼š_____________</div>
        </div>
    </div>
    
    <div class="page-footer">
        <p><strong>ğŸ¥ ä¸Šå‰é†«ç™‚è—¥å“é†«æè«‹è³¼ç³»çµ±</strong></p>
        <p>ğŸ“ è¯çµ¡é›»è©±ï¼š(02) 1234-5678 | ğŸ“§ Email: procurement@shangi-medical.com</p>
        <p>ğŸŒ ç³»çµ±ç¶²å€: https://yourusername.github.io/medical-procurement-system</p>
        <p style="font-size: 10px; margin-top: 15px; color: #999;">
            æœ¬æ–‡ä»¶ç”±ç³»çµ±è‡ªå‹•ç”Ÿæˆï¼Œå¦‚æœ‰ç–‘å•è«‹è¯ç¹«è³‡è¨Šéƒ¨é–€<br>
            GitHub Pages éƒ¨ç½²ç‰ˆæœ¬ - é–‹æºé†«ç™‚ç®¡ç†ç³»çµ±
        </p>
    </div>
</body>
</html>`;

            // å‰µå»ºä¸¦ä¸‹è¼‰HTMLæ–‡ä»¶
            const blob = new Blob([pdfContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${data.procurementNo || data.purchaseNo}_${type === 'procurement' ? 'è«‹è³¼å–®' : 'æ¡è³¼å–®'}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            setTimeout(() => {
                showNotification(`${data.procurementNo || data.purchaseNo} æ–‡ä»¶ä¸‹è¼‰å®Œæˆ`, 'success');
            }, 1000);
        }

        // ç”Ÿæˆç¤ºä¾‹PDF
        function generateSamplePDF(docId) {
            const sampleData = {
                procurementNo: docId,
                applyDate: '2025-07-25',
                department: 'ç¤ºä¾‹éƒ¨é–€',
                applicantName: 'ç¤ºä¾‹ç”³è«‹äºº',
                procurementReason: 'ç¤ºä¾‹è«‹è³¼äº‹ç”± - é€™æ˜¯ä¸€å€‹æ¼”ç¤ºç”¨çš„è«‹è³¼å–®',
                status: 'å·²æ ¸å‡†',
                submitTime: new Date().toLocaleString('zh-TW'),
                approver: 'ç¤ºä¾‹ä¸»ç®¡',
                approveTime: new Date().toLocaleString('zh-TW'),
                items: [
                    {
                        category: 'é†«æ',
                        itemName: 'è¡€å£“è¨ˆ',
                        specification: 'é›»å­å¼',
                        quantity: 2,
                        unit: 'å°',
                        unitPrice: 1500,
                        subtotal: 3000
                    },
                    {
                        category: 'è—¥å“',
                        itemName: 'é˜¿æ–¯åŒ¹éˆ',
                        specification: '100mg',
                        quantity: 5,
                        unit: 'ç›’',
                        unitPrice: 200,
                        subtotal: 1000
                    }
                ],
                totalAmount: 4000
            };
            generatePDF(sampleData, 'procurement');
        }

        // ä¸‹è¼‰æ‰€æœ‰å·²æ ¸å‡†æ–‡ä»¶
        function downloadAllApproved() {
            if (confirm('ç¢ºå®šè¦ä¸‹è¼‰æ‰€æœ‰å·²æ ¸å‡†çš„è«‹è³¼å–®å—ï¼Ÿ')) {
                showNotification('æ­£åœ¨æ‰“åŒ…ä¸‹è¼‰æ‰€æœ‰å·²æ ¸å‡†æ–‡ä»¶...', 'success');
                
                if (approvedProcurements.length === 0) {
                    showNotification('ç›®å‰æ²’æœ‰å·²æ ¸å‡†çš„è«‹è³¼å–®', 'error');
                    return;
                }
                
                // ç”Ÿæˆåˆä½µçš„HTMLæ–‡ä»¶
                let combinedContent = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å·²æ ¸å‡†è«‹è³¼å–®åŒ¯ç¸½ - ä¸Šå‰é†«ç™‚</title>
    <style>
        body { 
            font-family: 'Microsoft JhengHei', Arial, sans-serif; 
            margin: 20px; 
            line-height: 1.6;
            color: #333;
        }
        .header { 
            text-align: center; 
            border-bottom: 3px solid #667eea; 
            padding-bottom: 20px; 
            margin-bottom: 30px;
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
            padding: 40px;
            border-radius: 15px;
        }
        .document { 
            margin-bottom: 50px; 
            page-break-after: always; 
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 30px;
            background: #fafafa;
        }
        .info-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 20px; 
        }
        .info-table td { 
            padding: 10px 15px; 
            border: 1px solid #ddd; 
        }
        .info-table td:first-child {
            background: #f0f4ff;
            font-weight: bold;
            color: #667eea;
            width: 25%;
        }
        .items-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        .items-table th, .items-table td { 
            padding: 10px; 
            border: 1px solid #333; 
            text-align: center; 
        }
        .items-table th { 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            color: white;
        }
        .total { 
            text-align: right; 
            margin-top: 20px; 
            font-size: 18px; 
            font-weight: bold; 
            color: #667eea;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
        }
        .summary { 
            background: linear-gradient(135deg, #f8f9fa, #e3f2fd); 
            padding: 30px; 
            border-radius: 15px; 
            margin-bottom: 40px; 
            border: 2px solid #667eea;
        }
        .summary h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¥ ä¸Šå‰é†«ç™‚ - å·²æ ¸å‡†è«‹è³¼å–®åŒ¯ç¸½å ±å‘Š</h1>
        <p style="font-size: 16px; margin: 15px 0; color: #666;">åŒ¯ç¸½ç”Ÿæˆæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}</p>
        <p style="font-size: 18px; color: #667eea; font-weight: bold;">å…±æ”¶éŒ„ ${approvedProcurements.length} ç­†å·²æ ¸å‡†è«‹è³¼å–®</p>
    </div>
    
    <div class="summary">
        <h2>ğŸ“Š çµ±è¨ˆæ‘˜è¦</h2>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">${approvedProcurements.length}</div>
                <div>ç¸½ç­†æ•¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">NT$ ${approvedProcurements.reduce((sum, proc) => sum + proc.totalAmount, 0).toLocaleString()}</div>
                <div>ç¸½é‡‘é¡</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">${approvedProcurements.reduce((sum, proc) => sum + proc.items.length, 0)}</div>
                <div>ç¸½å“é …æ•¸</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">${[...new Set(approvedProcurements.map(p => p.department))].length}</div>
                <div>æ¶‰åŠéƒ¨é–€</div>
            </div>
        </div>
        
        <h3 style="margin-top: 25px; color: #667eea;">ğŸ“… æ ¸å‡†æ™‚é–“ç¯„åœ</h3>
        <p><strong>èµ·å§‹ï¼š</strong>${approvedProcurements.length > 0 ? approvedProcurements[0].approveTime : 'N/A'}</p>
        <p><strong>çµæŸï¼š</strong>${approvedProcurements.length > 0 ? approvedProcurements[approvedProcurements.length - 1].approveTime : 'N/A'}</p>
    </div>
    
    ${approvedProcurements.map((data, index) => `
    <div class="document">
        <h2 style="color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px;">
            è«‹è³¼å–® ${index + 1} - ${data.procurementNo}
        </h2>
        
        <table class="info-table">
            <tr>
                <td><strong>è«‹è³¼å–®è™Ÿ</strong></td>
                <td>${data.procurementNo}</td>
                <td><strong>ç”³è«‹æ—¥æœŸ</strong></td>
                <td>${data.applyDate}</td>
            </tr>
            <tr>
                <td><strong>ç”³è«‹éƒ¨é–€</strong></td>
                <td>${data.department}</td>
                <td><strong>ç”³è«‹äºº</strong></td>
                <td>${data.applicantName}</td>
            </tr>
            <tr>
                <td><strong>è«‹è³¼äº‹ç”±</strong></td>
                <td colspan="3">${data.procurementReason}</td>
            </tr>
            <tr>
                <td><strong>æ ¸å‡†äºº</strong></td>
                <td>${data.approver}</td>
                <td><strong>æ ¸å‡†æ™‚é–“</strong></td>
                <td>${data.approveTime}</td>
            </tr>
        </table>
        
        <h3 style="color: #667eea; margin: 20px 0 10px 0;">ğŸ“‹ è«‹è³¼å“é …æ˜ç´°</h3>
        <table class="items-table">
            <thead>
                <tr>
                    <th>é …æ¬¡</th>
                    <th>é¡åˆ¥</th>
                    <th>åç¨±</th>
                    <th>è¦æ ¼</th>
                    <th>æ•¸é‡</th>
                    <th>å–®ä½</th>
                    <th>å–®åƒ¹</th>
                    <th>å°è¨ˆ</th>
                </tr>
            </thead>
            <tbody>
                ${data.items.map((item, itemIndex) => `
                    <tr>
                        <td><strong>${itemIndex + 1}</strong></td>
                        <td>${item.category}</td>
                        <td style="text-align: left;"><strong>${item.itemName}</strong></td>
                        <td style="text-align: left;">${item.specification || '-'}</td>
                        <td><strong>${item.quantity}</strong></td>
                        <td>${item.unit}</td>
                        <td style="text-align: right;">NT$ ${item.unitPrice.toLocaleString()}</td>
                        <td style="text-align: right;"><strong>NT$ ${item.subtotal.toLocaleString()}</strong></td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
        
        <div class="total">
            ğŸ’° å–®æ“šç¸½é‡‘é¡ï¼šNT$ ${data.totalAmount.toLocaleString()}
        </div>
    </div>
    `).join('')}
    
    <div style="text-align: center; color: #666; font-size: 12px; margin-top: 50px; padding: 20px; border-top: 2px solid #667eea;">
        <p><strong>ğŸ¥ ä¸Šå‰é†«ç™‚è—¥å“é†«æè«‹è³¼ç³»çµ±</strong></p>
        <p>æ­¤åŒ¯ç¸½å ±å‘ŠåŒ…å«æ‰€æœ‰å·²æ ¸å‡†è«‹è³¼å–®çš„å®Œæ•´è³‡è¨Š</p>
        <p>GitHub Pages é–‹æºç‰ˆæœ¬ - ç”±ç³»çµ±è‡ªå‹•ç”Ÿæˆ</p>
        <p style="margin-top: 10px;">ğŸ“… å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}</p>
    </div>
</body>
</html>`;

                // å‰µå»ºä¸¦ä¸‹è¼‰åˆä½µæ–‡ä»¶
                const blob = new Blob([combinedContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `å·²æ ¸å‡†è«‹è³¼å–®åŒ¯ç¸½_${new Date().toISOString().slice(0, 10)}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                setTimeout(() => {
                    showNotification(`åŒ¯ç¸½å ±å‘Šä¸‹è¼‰å®Œæˆ (${approvedProcurements.length} ç­†è³‡æ–™)`, 'success');
                }, 2000);
            }
        }

        // æ·»åŠ CSSå‹•ç•«
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // ç³»çµ±ç®¡ç†åŠŸèƒ½å ä½ç¬¦
        function addUser() {
            showNotification('ä½¿ç”¨è€…ç®¡ç†åŠŸèƒ½å±•ç¤ºä¸­ - é€™æ˜¯æ¼”ç¤ºç‰ˆæœ¬', 'success');
        }

        function editUser(username) {
            showNotification(`ç·¨è¼¯ä½¿ç”¨è€…åŠŸèƒ½å±•ç¤ºä¸­ï¼š${username}`, 'success');
        }

        function deleteUser(username) {
            if (username === 'admin') {
                showNotification('ç„¡æ³•åˆªé™¤ç³»çµ±ç®¡ç†å“¡å¸³è™Ÿ', 'error');
                return;
            }
            showNotification(`åˆªé™¤ä½¿ç”¨è€…åŠŸèƒ½å±•ç¤ºä¸­ï¼š${username}`, 'success');
        }

        function addApprover() {
            showNotification('ç°½æ ¸è¨­å®šåŠŸèƒ½å±•ç¤ºä¸­ - é€™æ˜¯æ¼”ç¤ºç‰ˆæœ¬', 'success');
        }

        function editApprover(id) {
            showNotification(`ç·¨è¼¯ç°½æ ¸è¨­å®šåŠŸèƒ½å±•ç¤ºä¸­ï¼š${id}`, 'success');
        }

        function deleteApprover(id) {
            showNotification(`åˆªé™¤ç°½æ ¸è¨­å®šåŠŸèƒ½å±•ç¤ºä¸­ï¼š${id}`, 'success');
        }

        // æ¡è³¼å–®ç®¡ç†åŠŸèƒ½
        function addPurchaseItem() {
            purchaseItemCounter++;
            const tableBody = document.getElementById('purchaseItemsTableBody');
            if (!tableBody) return;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" name="itemCode_${purchaseItemCounter}" placeholder="å“é …ç·¨è™Ÿ" required></td>
                <td><input type="text" name="purchaseItemName_${purchaseItemCounter}" placeholder="å“é …åç¨±" required></td>
                <td><input type="text" name="purchaseSpec_${purchaseItemCounter}" placeholder="è¦æ ¼"></td>
                <td><input type="number" name="purchaseQuantity_${purchaseItemCounter}" placeholder="æ•¸é‡" min="1" onchange="updatePurchaseTotal()" required></td>
                <td>
                    <select name="purchaseUnit_${purchaseItemCounter}" required>
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="ç›’">ç›’</option>
                        <option value="ç“¶">ç“¶</option>
                        <option value="æ”¯">æ”¯</option>
                        <option value="å€‹">å€‹</option>
                        <option value="åŒ…">åŒ…</option>
                        <option value="å°">å°</option>
                    </select>
                </td>
                <td><input type="number" name="purchaseUnitPrice_${purchaseItemCounter}" placeholder="å–®åƒ¹" min="0" step="0.01" onchange="updatePurchaseTotal()"></td>
                <td class="purchase-subtotal">0</td>
                <td><button type="button" class="btn btn-danger" onclick="removePurchaseItem(this)">ğŸ—‘ï¸</button></td>
            `;
            tableBody.appendChild(row);
        }

        // ç§»é™¤æ¡è³¼å“é …
        function removePurchaseItem(button) {
            if (confirm('ç¢ºå®šè¦ç§»é™¤æ­¤å“é …å—ï¼Ÿ')) {
                button.closest('tr').remove();
                updatePurchaseTotal();
            }
        }

        // æ›´æ–°æ¡è³¼ç¸½é‡‘é¡
        function updatePurchaseTotal() {
            let total = 0;
            const tableBody = document.getElementById('purchaseItemsTableBody');
            if (!tableBody) return;
            
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const quantityInput = row.querySelector('input[name^="purchaseQuantity"]');
                const unitPriceInput = row.querySelector('input[name^="purchaseUnitPrice"]');
                const subtotalCell = row.querySelector('.purchase-subtotal');
                
                if (quantityInput && unitPriceInput && subtotalCell) {
                    const quantity = parseFloat(quantityInput.value) || 0;
                    const unitPrice = parseFloat(unitPriceInput.value) || 0;
                    const subtotal = quantity * unitPrice;
                    
                    subtotalCell.textContent = subtotal.toLocaleString();
                    total += subtotal;
                }
            });
            
            const totalAmountSpan = document.getElementById('purchaseTotalAmount');
            if (totalAmountSpan) {
                totalAmountSpan.textContent = total.toLocaleString();
            }
        }

        // æäº¤æ¡è³¼å–®
        function submitPurchase() {
            console.log('æäº¤æ¡è³¼å–®...');
            
            // åŸºæœ¬è³‡æ–™é©—è­‰
            const purchaseNo = document.getElementById('purchaseNo')?.value;
            const purchaseDate = document.getElementById('purchaseDate')?.value;
            const supplier = document.getElementById('supplier')?.value;
            const contactPerson = document.getElementById('contactPerson')?.value;
            const purchaseNote = document.getElementById('purchaseNote')?.value;
            
            if (!supplier) {
                showNotification('è«‹é¸æ“‡ä¾›æ‡‰å•†', 'error');
                return;
            }
            
            if (!contactPerson) {
                showNotification('è«‹å¡«å¯«è¯çµ¡äºº', 'error');
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦æœ‰å“é …
            const tableBody = document.getElementById('purchaseItemsTableBody');
            if (!tableBody || tableBody.children.length === 0) {
                showNotification('è«‹è‡³å°‘æ–°å¢ä¸€å€‹å“é …', 'error');
                return;
            }
            
            // é©—è­‰å“é …è³‡æ–™ä¸¦æ”¶é›†å“é …è³‡è¨Š
            let isValid = true;
            let items = [];
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach((row, index) => {
                const itemCode = row.querySelector('input[name^="itemCode"]')?.value;
                const itemName = row.querySelector('input[name^="purchaseItemName"]')?.value;
                const specification = row.querySelector('input[name^="purchaseSpec"]')?.value;
                const quantity = row.querySelector('input[name^="purchaseQuantity"]')?.value;
                const unit = row.querySelector('select[name^="purchaseUnit"]')?.value;
                const unitPrice = row.querySelector('input[name^="purchaseUnitPrice"]')?.value;
                
                if (!itemCode || !itemName || !quantity || !unit) {
                    showNotification(`ç¬¬ ${index + 1} å€‹å“é …è³‡æ–™ä¸å®Œæ•´`, 'error');
                    isValid = false;
                    return;
                }
                
                items.push({
                    itemCode,
                    itemName,
                    specification: specification || '',
                    quantity: parseInt(quantity),
                    unit,
                    unitPrice: parseFloat(unitPrice) || 0,
                    subtotal: (parseInt(quantity) * (parseFloat(unitPrice) || 0))
                });
            });
            
            if (!isValid) return;
            
            // è¨ˆç®—ç¸½é‡‘é¡
            const totalAmount = items.reduce((sum, item) => sum + item.subtotal, 0);
            
            // å‰µå»ºæ–°çš„æ¡è³¼å–®ç‰©ä»¶
            const newPurchase = {
                purchaseNo,
                purchaseDate,
                supplier,
                contactPerson,
                purchaseNote: purchaseNote || '',
                items,
                totalAmount,
                status: 'å¾…å¯©æ ¸',
                submitTime: new Date().toLocaleString('zh-TW')
            };
            
            // åŠ å…¥åˆ°å¾…å¯©æ ¸åˆ—è¡¨
            pendingPurchases.push(newPurchase);
            
            // æ›´æ–°ç°½æ ¸ç®¡ç†é é¢çš„è¡¨æ ¼
            updatePendingPurchaseTable();
            
            // æäº¤æˆåŠŸ
            showNotification('æ¡è³¼å–®æäº¤æˆåŠŸï¼', 'success');
            resetPurchaseForm();
            
            // æ›´æ–°å¾…å¯©æ ¸æ•¸é‡
            updatePendingCount();
            
            console.log('æ–°æ¡è³¼å–®å·²åŠ å…¥:', newPurchase);
        }

        // é‡è¨­æ¡è³¼è¡¨å–®
        function resetPurchaseForm() {
            const form = document.getElementById('purchaseForm');
            if (form) {
                form.reset();
            }
            
            const tableBody = document.getElementById('purchaseItemsTableBody');
            if (tableBody) {
                tableBody.innerHTML = '';
            }
            
            const totalAmount = document.getElementById('purchaseTotalAmount');
            if (totalAmount) {
                totalAmount.textContent = '0';
            }
            
            generatePurchaseNo();
            const today = new Date().toISOString().split('T')[0];
            const purchaseDate = document.getElementById('purchaseDate');
            if (purchaseDate) {
                purchaseDate.value = today;
            }
            
            purchaseItemCounter = 0;
        }

        // æ›´æ–°å¾…å¯©æ ¸æ¡è³¼å–®è¡¨æ ¼
        function updatePendingPurchaseTable() {
            const tableBody = document.getElementById('pendingPurchaseTable');
            if (!tableBody) return;
            
            // æ¸…ç©ºç¾æœ‰å…§å®¹
            tableBody.innerHTML = '';
            
            // é‡æ–°æ·»åŠ å¾…å¯©æ ¸çš„æ¡è³¼å–®
            pendingPurchases.forEach(purchase => {
                const row = document.createElement('tr');
                row.setAttribute('data-dynamic', 'true');
                row.innerHTML = `
                    <td>${purchase.purchaseNo}</td>
                    <td>${purchase.purchaseDate}</td>
                    <td>${purchase.supplier}</td>
                    <td style="text-align: right; font-weight: bold; color: #667eea;">NT$ ${purchase.totalAmount.toLocaleString()}</td>
                    <td><span class="status-badge status-pending">å¾…å¯©æ ¸</span></td>
                    <td>
                        <button class="btn btn-success" onclick="approveDocument('${purchase.purchaseNo}', 'purchase')">âœ… æ ¸å‡†</button>
                        <button class="btn btn-danger" onclick="rejectDocument('${purchase.purchaseNo}', 'purchase')">ğŸš« é§å›</button>
                        <button class="btn btn-primary" onclick="viewPurchaseDocument('${purchase.purchaseNo}')">ğŸ‘ï¸ æŸ¥çœ‹</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // å¾è«‹è³¼å–®æ–°å¢æ¡è³¼å“é …
        function addPurchaseItemFromProcurement(procurementItem) {
            purchaseItemCounter++;
            const tableBody = document.getElementById('purchaseItemsTableBody');
            if (!tableBody) return;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" name="itemCode_${purchaseItemCounter}" value="${procurementItem.category}_${purchaseItemCounter.toString().padStart(3, '0')}" placeholder="å“é …ç·¨è™Ÿ"></td>
                <td><input type="text" name="purchaseItemName_${purchaseItemCounter}" value="${procurementItem.itemName}" placeholder="å“é …åç¨±"></td>
                <td><input type="text" name="purchaseSpec_${purchaseItemCounter}" value="${procurementItem.specification || ''}" placeholder="è¦æ ¼"></td>
                <td><input type="number" name="purchaseQuantity_${purchaseItemCounter}" value="${procurementItem.quantity}" placeholder="æ•¸é‡" onchange="updatePurchaseTotal()"></td>
                <td>
                    <select name="purchaseUnit_${purchaseItemCounter}">
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="ç›’" ${procurementItem.unit === 'ç›’' ? 'selected' : ''}>ç›’</option>
                        <option value="ç“¶" ${procurementItem.unit === 'ç“¶' ? 'selected' : ''}>ç“¶</option>
                        <option value="æ”¯" ${procurementItem.unit === 'æ”¯' ? 'selected' : ''}>æ”¯</option>
                        <option value="å€‹" ${procurementItem.unit === 'å€‹' ? 'selected' : ''}>å€‹</option>
                        <option value="åŒ…" ${procurementItem.unit === 'åŒ…' ? 'selected' : ''}>åŒ…</option>
                        <option value="å°" ${procurementItem.unit === 'å°' ? 'selected' : ''}>å°</option>
                    </select>
                </td>
                <td><input type="number" name="purchaseUnitPrice_${purchaseItemCounter}" value="${procurementItem.unitPrice}" placeholder="å–®åƒ¹" onchange="updatePurchaseTotal()"></td>
                <td class="purchase-subtotal">${(procurementItem.quantity * procurementItem.unitPrice).toLocaleString()}</td>
                <td><button type="button" class="btn btn-danger" onclick="removePurchaseItem(this)">ğŸ—‘ï¸</button></td>
            `;
            tableBody.appendChild(row);
        }

        // å¾å‹¾é¸é …ç›®å»ºç«‹æ¡è³¼å–®
        function createPurchaseFromSelected() {
            console.log('å»ºç«‹æ¡è³¼å–®å¾é¸æ“‡é …ç›®...');
            
            const selectedCheckboxes = document.querySelectorAll('.approved-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showNotification('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å·²æ ¸å‡†çš„è«‹è³¼å–®', 'error');
                return;
            }
            
            const selectedProcurements = [];
            selectedCheckboxes.forEach(checkbox => {
                const procurementId = checkbox.getAttribute('data-procurement-id');
                const procurement = approvedProcurements.find(p => p.procurementNo === procurementId);
                if (procurement) {
                    selectedProcurements.push(procurement);
                }
            });
            
            if (selectedProcurements.length === 0) {
                showNotification('æ‰¾ä¸åˆ°é¸æ“‡çš„è«‹è³¼å–®è³‡æ–™', 'error');
                return;
            }
            
            // åˆ‡æ›åˆ°å»ºç«‹æ¡è³¼å–®é é¢
            showPage('createPurchase');
            
            // ç­‰å¾…é é¢åˆ‡æ›å®Œæˆå¾Œå†åŸ·è¡Œ
            setTimeout(() => {
                // æ‰¾åˆ°å°æ‡‰çš„æŒ‰éˆ•ä¸¦è¨­ç‚º active
                const buttons = document.querySelectorAll('.nav-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
                
                const createPurchaseBtn = Array.from(buttons).find(btn => 
                    btn.onclick && btn.onclick.toString().includes('createPurchase')
                );
                if (createPurchaseBtn) {
                    createPurchaseBtn.classList.add('active');
                }
                
                // æ¸…ç©ºç¾æœ‰çš„æ¡è³¼å“é …
                const tableBody = document.getElementById('purchaseItemsTableBody');
                if (tableBody) {
                    tableBody.innerHTML = '';
                }
                purchaseItemCounter = 0;
                
                // å¡«å…¥é¸æ“‡çš„è«‹è³¼å–®å“é …
                selectedProcurements.forEach(procurement => {
                    procurement.items.forEach(item => {
                        addPurchaseItemFromProcurement(item);
                    });
                });
                
                // æ›´æ–°ç¸½é‡‘é¡
                updatePurchaseTotal();
                
                // è¨­ç½®å‚™è¨»
                const noteField = document.getElementById('purchaseNote');
                if (noteField) {
                    noteField.value = `æ ¹æ“šä»¥ä¸‹è«‹è³¼å–®å»ºç«‹ï¼š${selectedProcurements.map(p => p.procurementNo).join(', ')}`;
                }
                
                // é¡¯ç¤ºæç¤ºè¨Šæ¯
                showNotification(`å·²å¾ ${selectedProcurements.length} å€‹è«‹è³¼å–®åŒ¯å…¥ ${selectedProcurements.reduce((sum, p) => sum + p.items.length, 0)} å€‹å“é …`, 'success');
                
                console.log('æ¡è³¼å–®å“é …å·²åŒ¯å…¥:', selectedProcurements);
            }, 100);
        }

        // æŸ¥çœ‹æ¡è³¼æ–‡ä»¶
        function viewPurchaseDocument(docId) {
            let documentData = null;
            
            // å¾å¾…å¯©æ ¸æ¡è³¼å–®ä¸­å°‹æ‰¾
            documentData = pendingPurchases.find(purch => purch.purchaseNo === docId);
            
            // å¦‚æœåœ¨å¾…å¯©æ ¸ä¸­æ²’æ‰¾åˆ°ï¼Œå†å¾å·²æ ¸å‡†ä¸­å°‹æ‰¾
            if (!documentData && window.approvedPurchases) {
                documentData = window.approvedPurchases.find(purch => purch.purchaseNo === docId);
            }
            
            // å¦‚æœé‚„æ˜¯æ²’æ‰¾åˆ°ï¼Œå¾å·²é§å›ä¸­å°‹æ‰¾
            if (!documentData && window.rejectedPurchases) {
                documentData = window.rejectedPurchases.find(purch => purch.purchaseNo === docId);
            }
            
            if (documentData) {
                // é¡¯ç¤ºçœŸå¯¦çš„æ¡è³¼å–®è³‡æ–™
                document.getElementById('modalTitle').textContent = `æŸ¥çœ‹æ¡è³¼å–® ${docId}`;
                
                let itemsTableHTML = '';
                documentData.items.forEach((item, index) => {
                    itemsTableHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${item.itemCode}</td>
                            <td>${item.itemName}</td>
                            <td>${item.specification || '-'}</td>
                            <td>${item.quantity}</td>
                            <td>${item.unit}</td>
                            <td style="text-align: right;">NT$ ${item.unitPrice.toLocaleString()}</td>
                            <td style="text-align: right; font-weight: bold;">NT$ ${item.subtotal.toLocaleString()}</td>
                        </tr>
                    `;
                });
                
                document.getElementById('modalContent').innerHTML = `
                    <div class="form-row">
                        <div class="form-col">
                            <strong>æ¡è³¼å–®è™Ÿï¼š</strong>${documentData.purchaseNo}
                        </div>
                        <div class="form-col">
                            <strong>æ¡è³¼æ—¥æœŸï¼š</strong>${documentData.purchaseDate}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <strong>ä¾›æ‡‰å•†ï¼š</strong>${documentData.supplier}
                        </div>
                        <div class="form-col">
                            <strong>è¯çµ¡äººï¼š</strong>${documentData.contactPerson}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <strong>å‚™è¨»ï¼š</strong>${documentData.purchaseNote || 'ç„¡'}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <strong>æäº¤æ™‚é–“ï¼š</strong>${documentData.submitTime}
                        </div>
                        <div class="form-col">
                            <strong>ç‹€æ…‹ï¼š</strong><span class="status-badge ${documentData.status === 'å·²æ ¸å‡†' ? 'status-approved' : documentData.status === 'å·²é§å›' ? 'status-rejected' : 'status-pending'}">${documentData.status}</span>
                        </div>
                    </div>
                    ${documentData.approver ? `
                    <div class="form-row">
                        <div class="form-col">
                            <strong>æ ¸å‡†äººï¼š</strong>${documentData.approver}
                        </div>
                        <div class="form-col">
                            <strong>æ ¸å‡†æ™‚é–“ï¼š</strong>${documentData.approveTime}
                        </div>
                    </div>` : ''}
                    ${documentData.rejecter ? `
                    <div class="form-row">
                        <div class="form-col">
                            <strong>é§å›äººï¼š</strong>${documentData.rejecter}
                        </div>
                        <div class="form-col">
                            <strong>é§å›æ™‚é–“ï¼š</strong>${documentData.rejectTime}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <strong>é§å›åŸå› ï¼š</strong>${documentData.rejectReason}
                        </div>
                    </div>` : ''}
                    <h4 style="margin-top: 25px; color: #333;">æ¡è³¼å“é …æ˜ç´°</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>é …æ¬¡</th>
                                <th>å“é …ç·¨è™Ÿ</th>
                                <th>å“é …åç¨±</th>
                                <th>è¦æ ¼</th>
                                <th>æ•¸é‡</th>
                                <th>å–®ä½</th>
                                <th>å–®åƒ¹</th>
                                <th>å°è¨ˆ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsTableHTML}
                        </tbody>
                    </table>
                    <div style="text-align: right; margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong style="font-size: 18px; color: #667eea;">ç¸½é‡‘é¡ï¼šNT$ ${documentData.totalAmount.toLocaleString()}</strong>
                    </div>
                `;
            } else {
                // å¦‚æœæ‰¾ä¸åˆ°è³‡æ–™ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                document.getElementById('modalTitle').textContent = `æŸ¥çœ‹æ¡è³¼å–® ${docId}`;
                document.getElementById('modalContent').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>âŒ</strong> æ‰¾ä¸åˆ°æ­¤æ¡è³¼å–®çš„è©³ç´°è³‡æ–™
                    </div>
                `;
            }
            
            document.getElementById('viewModal').style.display = 'block';
        }

        function addInventoryItem() {
            showNotification('åº«å­˜ç®¡ç†åŠŸèƒ½å®Œæ•´å¯¦ç¾ä¸­...', 'success');
        }

        function editInventoryItem(itemCode) {
            showNotification(`ç·¨è¼¯åº«å­˜å“é …åŠŸèƒ½å®Œæ•´å¯¦ç¾ä¸­ï¼š${itemCode}`, 'success');
        }

        function deleteInventoryItem(itemCode) {
            showNotification(`åˆªé™¤åº«å­˜å“é …åŠŸèƒ½å®Œæ•´å¯¦ç¾ä¸­ï¼š${itemCode}`, 'success');
        }

        function handleFileUpload(event) {
            showNotification('Excelä¸Šå‚³åŠŸèƒ½å®Œæ•´å¯¦ç¾ä¸­...', 'success');
        }

        function searchInventory(keyword) {
            showNotification('åº«å­˜æœå°‹åŠŸèƒ½å®Œæ•´å¯¦ç¾ä¸­...', 'success');
        }

        function downloadInventoryList() {
            showNotification('åº«å­˜æ¸…å–®ä¸‹è¼‰åŠŸèƒ½å®Œæ•´å¯¦ç¾ä¸­...', 'success');
        }

        // ç¢ºä¿æ‰€æœ‰å¿…è¦çš„å‡½æ•¸éƒ½å·²å®šç¾©
        console.log('ğŸ‰ ä¸Šå‰é†«ç™‚è—¥å“é†«æè«‹è³¼ç³»çµ± - GitHub Pagesç‰ˆæœ¬åˆå§‹åŒ–å®Œæˆ');
        console.log('âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²è¼‰å…¥');
        console.log('ğŸ”§ éƒ¨åˆ†åŠŸèƒ½ç‚ºæ¼”ç¤ºç‰ˆæœ¬ï¼Œé©åˆGitHub Pageséƒ¨ç½²');

    </script>
</body>
</html>
